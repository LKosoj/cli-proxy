# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: —Ä–µ–∂–∏–º Manager (–º—É–ª—å—Ç–∏-–∞–≥–µ–Ω—Ç–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

## 1. –¶–µ–ª—å

–î–æ–±–∞–≤–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —Ç—Ä–µ—Ç–∏–π —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —Å–µ—Å—Å–∏–∏ ‚Äî **Manager**. –í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞—ë—Ç –æ–¥–Ω—É –±–æ–ª—å—à—É—é –∑–∞–¥–∞—á—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´—Å–æ–∑–¥–∞–π REST API –Ω–∞ FastAPI¬ª), –∞ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. –î–µ–∫–æ–º–ø–æ–∑–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏ (DevTask).
2. –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –¢–ó –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –≤ **CLI —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏** (`session.run_prompt`).
3. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É (—Ä–µ–≤—å—é) –≤ **Agent** (`Executor` + `ReActAgent` —Å read-only –ø—Ä–æ—Ñ–∏–ª–µ–º).
4. –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º —Ä–µ–≤—å—é –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ; –ø—Ä–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á—É –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É (—á–µ—Ä–µ–∑ CLI) —Å –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏ —Ä–µ–≤—å—é–µ—Ä–∞.
5. –ü–æ–≤—Ç–æ—Ä—è–µ—Ç —Ü–∏–∫–ª –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∑–∞–¥–∞—á –∏–ª–∏ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫.
6. –§–æ—Ä–º–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç.

## 2. –ú–µ—Å—Ç–æ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### 2.1. –¢—Ä–∏ —Ä–µ–∂–∏–º–∞ —Å–µ—Å—Å–∏–∏

| –†–µ–∂–∏–º | –§–ª–∞–≥ | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ `bot.py` | –ö—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É |
|-------|------|--------------------------|---------------------|
| **CLI** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | `agent_enabled=False`, `manager_enabled=False` | `session.run_prompt(text)` | CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç (codex/claude/gemini/qwen) |
| **Agent** | `agent_enabled=True` | `orchestrator.run(session, text, ...)` | `OrchestratorRunner` ‚Üí `ReActAgent` ‚Üí –ø–ª–∞–≥–∏–Ω—ã |
| **Manager** (–Ω–æ–≤—ã–π) | `manager_enabled=True` | `manager_orchestrator.run(session, text, ...)` | `ManagerOrchestrator` (–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è + —Ü–∏–∫–ª) |

### 2.2. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∂–∏–º–æ–≤

Manager –∏ Agent ‚Äî –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏–µ. –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ Manager –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∫–ª—é—á–∞–µ—Ç—Å—è Agent –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç:

```python
# bot.py: _handle_user_input
if session.manager_enabled:
    await self._handle_manager_input(session, text, chat_id, context, dest)
elif session.agent_enabled:
    await self._handle_agent_input(session, text, chat_id, context, dest)
else:
    await self._handle_cli_input(session, text, chat_id, context, dest)
```

### 2.3. –°—Ö–µ–º–∞ –≤—ã–∑–æ–≤–æ–≤ –≤–Ω—É—Ç—Ä–∏ Manager

```
ManagerOrchestrator.run(session, user_goal, bot, context, dest)
‚îÇ
‚îú‚îÄ‚îÄ 1. _decompose(user_goal, session)  [–¥–≤—É—Ö—Ñ–∞–∑–Ω–∞—è]
‚îÇ       ‚îú‚îÄ‚îÄ –§–∞–∑–∞ 1: session.run_prompt(decompose_instruction)
‚îÇ       ‚îÇ           (CLI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç: —Ñ–∞–π–ª—ã, git, —Ç–µ—Å—Ç—ã
‚îÇ       ‚îÇ            ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–∞–ª–∏–∑ + –ø–ª–∞–Ω —Å–≤–æ–±–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º)
‚îÇ       ‚îî‚îÄ‚îÄ –§–∞–∑–∞ 2: chat_completion(NORMALIZE_SYSTEM, cli_output)
‚îÇ                   (Agent –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –≤ –≤–∞–ª–∏–¥–Ω—ã–π
‚îÇ                    JSON ‚Üí ProjectPlan)
‚îÇ
‚îú‚îÄ‚îÄ 2. –¶–ò–ö–õ –ø–æ –∑–∞–¥–∞—á–∞–º:
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ _delegate_develop(task, session)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ session.run_prompt(dev_instruction)
‚îÇ   ‚îÇ           (CLI –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ _delegate_review(task)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Executor.run(req, profile=reviewer)
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ ReActAgent ‚Üí read_file, search_text, run_command...
‚îÇ   ‚îÇ               (Agent –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç read-only –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ _make_decision(dev_report, review_report)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ chat_completion() ‚Üí approved / rejected + reasons
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ if rejected && attempt < max_attempts ‚Üí –ø–æ–≤—Ç–æ—Ä —Å –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏
‚îÇ       if rejected && attempt >= max_attempts ‚Üí –ø–æ–º–µ—Ç–∏—Ç—å failed
‚îÇ       if approved ‚Üí —Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞
‚îÇ
‚îî‚îÄ‚îÄ 3. _compose_final_report(plan) ‚Üí chat_completion() ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
```

## 3. –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `agent/manager.py` | –ö–ª–∞—Å—Å `ManagerOrchestrator` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ü–∏–∫–ª–∞ |
| `agent/manager_store.py` | –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ `MANAGER_PLAN.json` |
| `agent/manager_prompts.py` | –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏, —Ä–µ–≤—å—é, —Ä–µ—à–µ–Ω–∏–π, —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ |

## 4. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö

| –§–∞–π–ª | –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è |
|------|-------------|
| `session.py` | –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `manager_enabled: bool = False` –≤ `Session` |
| `bot.py` | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –≤ `_handle_user_input`; –º–µ—Ç–æ–¥ `run_manager`; –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è manager-—Ä–µ–∂–∏–º–∞; –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `ManagerOrchestrator` |
| `command_registry.py` | –ù–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/manager` |
| `agent/contracts.py` | –ù–æ–≤—ã–µ dataclass'—ã: `DevTask`, `ProjectPlan`, `ReviewResult` |
| `agent/profiles.py` | –ù–æ–≤—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏: `developer_profile`, `reviewer_profile` |
| `config.py` | –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `DefaultsConfig`: `manager_*` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| `config.yaml` / `config_example.yaml` | –°–µ–∫—Ü–∏—è `defaults.manager_*` |
| `state.py` | –ü–æ–ª–µ `manager_enabled` –≤ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–µ—Å—Å–∏–∏ |

## 5. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö (`agent/contracts.py`)

### 5.1. DevTask

```python
@dataclass
class DevTask:
    """–û–¥–Ω–∞ –∑–∞–¥–∞—á–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ —Ä–∞–º–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞."""
    id: str                             # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (–Ω–∞–ø—Ä–∏–º–µ—Ä "task_1")
    title: str                          # –ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
    description: str                    # –ü–æ–¥—Ä–æ–±–Ω–æ–µ –¢–ó –¥–ª—è developer'–∞
    acceptance_criteria: List[str]      # –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ (—á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç reviewer)
    depends_on: List[str] = field(default_factory=list)  # ID –∑–∞–¥–∞—á-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    status: str = "pending"             # pending | in_progress | in_review | approved | rejected | failed | blocked
    attempt: int = 0                    # –¢–µ–∫—É—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ (–Ω–∞—á–∏–Ω–∞—è —Å 0)
    max_attempts: int = 3              # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫
    dev_report: Optional[str] = None    # –ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á—ë—Ç developer'–∞ (–æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π –¥–æ manager_dev_report_max_chars)
    review_verdict: Optional[str] = None  # –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤–µ—Ä–¥–∏–∫—Ç reviewer'–∞
    review_comments: Optional[str] = None # –ó–∞–º–µ—á–∞–Ω–∏—è reviewer'–∞
    rejection_history: List[Dict[str, Any]] = field(default_factory=list)
    # [{attempt: 1, comments: "...", timestamp: "..."}]
    started_at: Optional[str] = None
    completed_at: Optional[str] = None
```

### 5.2. ProjectPlan

```python
@dataclass
class ProjectAnalysis:
    """–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è CLI –ø—Ä–∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏)."""
    current_state: str                  # –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    already_done: List[str]             # –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
    remaining_work: List[str]           # –ß—Ç–æ –µ—â—ë –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç


@dataclass
class ProjectPlan:
    """–ü–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏."""
    project_goal: str                   # –ò—Å—Ö–æ–¥–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    tasks: List[DevTask]                # –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á
    analysis: Optional[ProjectAnalysis] = None  # –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç CLI
    status: str = "active"              # active | completed | failed | paused
    created_at: str = ""
    updated_at: str = ""
    current_task_id: Optional[str] = None  # ID —Ç–µ–∫—É—â–µ–π –≤—ã–ø–æ–ª–Ω—è–µ–º–æ–π –∑–∞–¥–∞—á–∏
    completion_report: Optional[str] = None  # –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
```

### 5.3. ReviewResult

```python
@dataclass
class ReviewResult:
    approved: bool
    summary: str                        # –ö—Ä–∞—Ç–∫–∏–π –∏—Ç–æ–≥ —Ä–µ–≤—å—é
    comments: str                       # –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è (–µ—Å–ª–∏ rejected)
    tests_passed: Optional[bool] = None # –ï—Å–ª–∏ —Ä–µ–≤—å—é–µ—Ä –∑–∞–ø—É—Å–∫–∞–ª —Ç–µ—Å—Ç—ã
    files_reviewed: List[str] = field(default_factory=list)  # –ö–∞–∫–∏–µ —Ñ–∞–π–ª—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–ª
```

## 6. ManagerOrchestrator (`agent/manager.py`)

### 6.1. –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

```python
class ManagerOrchestrator:
    def __init__(self, config: AppConfig):
        self._config = config
        tool_registry = get_tool_registry(config)
        self._executor = Executor(config, tool_registry)
        self._log = logging.getLogger("manager")
```

Manager –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `Executor` –¥–ª—è —Ä–µ–≤—å—é (Agent —Å read-only –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏). –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ ‚Äî –Ω–∞–ø—Ä—è–º—É—é `session.run_prompt()`.

### 6.2. –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª `run()`

```python
async def run(self, session, user_text, bot, context, dest) -> str:
```

**–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `session` ‚Äî –æ–±—ä–µ–∫—Ç `Session` (—Å–æ–¥–µ—Ä–∂–∏—Ç CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, workdir)
- `user_text` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –±–æ–ª—å—à–æ–π –∑–∞–¥–∞—á–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `bot`, `context`, `dest` ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Telegram-–≤—ã–≤–æ–¥–∞

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–ª–∞–Ω–∞:** –∑–∞–≥—Ä—É–∑–∏—Ç—å `MANAGER_PLAN.json`.
   - –ï—Å–ª–∏ –ø–ª–∞–Ω–∞ –Ω–µ—Ç ‚Üí –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π (—à–∞–≥ 2).
   - –ï—Å–ª–∏ –ø–ª–∞–Ω –µ—Å—Ç—å –∏ `status="active"`:
     - –ï—Å–ª–∏ `manager_auto_resume=True` ‚Üí –º–æ–ª—á–∞ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.
     - –ï—Å–ª–∏ `manager_auto_resume=False` ‚Üí —Å–ø—Ä–æ—Å–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ¬´–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω –∏–ª–∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π?¬ª.
   - –ï—Å–ª–∏ –ø–ª–∞–Ω `status="completed"|"failed"` ‚Üí –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π.

2. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è:** (–µ—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—ã–π –ø–ª–∞–Ω) –≤—ã–∑–≤–∞—Ç—å `_decompose`.

3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:** –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–ª–∞–Ω –≤ Telegram (—Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á, —Å—Ç–∞—Ç—É—Å—ã).

4. **–¶–∏–∫–ª –ø–æ –∑–∞–¥–∞—á–∞–º:**
   ```
   while not all_done(plan):
       task = next_ready_task(plan)
       if not task: break

       task.status = "in_progress"
       task.attempt += 1
       task.started_at = now()
       save_plan()
       notify_progress()

       # === –†–ê–ó–†–ê–ë–û–¢–ö–ê ===
       dev_report = await _delegate_develop(task, session)
       task.dev_report = dev_report
       task.status = "in_review"
       save_plan()

       # === –†–ï–í–¨–Æ ===
       review = await _delegate_review(task)
       task.review_verdict = "approved" if review.approved else "rejected"
       task.review_comments = review.comments

       # === –†–ï–®–ï–ù–ò–ï ===
       if review.approved:
           task.status = "approved"
           task.completed_at = now()
           notify("‚úÖ {task.title} ‚Äî –ø—Ä–∏–Ω—è—Ç–∞")
       else:
           task.rejection_history.append({
               "attempt": task.attempt,
               "comments": review.comments,
               "timestamp": now()
           })
           if task.attempt >= task.max_attempts:
               task.status = "failed"
               notify("‚ùå {task.title} ‚Äî –ø—Ä–æ–≤–∞–ª –ø–æ—Å–ª–µ {max_attempts} –ø–æ–ø—ã—Ç–æ–∫")
               # –ï—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äî –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–µ—Å—å –ø–ª–∞–Ω
               if self._is_plan_blocked(plan):
                   plan.status = "failed"
                   notify("‚õî –ü–ª–∞–Ω –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–µ–Ω–∞.")
                   break
           else:
               task.status = "pending"  # –≤–µ—Ä–Ω—ë—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å
               notify("üîÑ {task.title} ‚Äî –¥–æ—Ä–∞–±–æ—Ç–∫–∞ (–ø–æ–ø—ã—Ç–∫–∞ {attempt+1})")

       save_plan()
   ```

5. **–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç:** –≤—ã–∑–≤–∞—Ç—å `_compose_final_report(plan)` ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram.

6. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:**
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω —Å `status = "completed"` –∏–ª–∏ `"failed"`.
   - –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω (`archive_plan()`), —á—Ç–æ–±—ã –æ—á–∏—Å—Ç–∏—Ç—å —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–¥–∞—á.

### 6.3. –í—ã–±–æ—Ä —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏ `_next_ready_task()`

–£—á–∏—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`depends_on`):
- –ó–∞–¥–∞—á–∞ –≥–æ—Ç–æ–≤–∞, –µ—Å–ª–∏ –≤—Å–µ –µ—ë –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–º–µ—é—Ç `status == "approved"`.
- –ï—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏–º–µ–µ—Ç `status == "failed"` ‚Üí –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è `"blocked"`.
- –ü–æ—Ä—è–¥–æ–∫: –∑–∞–¥–∞—á–∏ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏, –∑–∞—Ç–µ–º –∑–∞–≤–∏—Å–∏–º—ã–µ –≤ –ø–æ—Ä—è–¥–∫–µ ID.

```python
# –°—Ç–∞—Ç—É—Å—ã, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–¥–∞—á–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è "–≥–æ—Ç–æ–≤–æ–π –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é":
# - "pending" ‚Äî –µ—â—ë –Ω–µ –Ω–∞—á–∞—Ç–∞ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞ –ø–æ—Å–ª–µ rejected
# - "rejected" ‚Äî —Ä–µ–≤—å—é –Ω–µ –ø—Ä–æ—à–ª–æ, –Ω–æ –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ –∏—Å—á–µ—Ä–ø–∞–Ω—ã
#   (–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ "pending" –ø—Ä–∏ –ø–æ–¥—Ö–≤–∞—Ç–µ)
# - "in_progress" / "in_review" ‚Äî –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–ø–æ—Å–ª–µ restart/crash)
#   (–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤ "pending", attempt –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º)
RETRIABLE_STATUSES = ("pending", "rejected", "in_progress", "in_review")

def _next_ready_task(self, plan: ProjectPlan) -> Optional[DevTask]:
    has_pending = False
    all_blocked_or_failed = True
    
    for task in plan.tasks:
        # –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ—Å–ª–µ —Å–±–æ—è/—Ä–µ—Å—Ç–∞—Ä—Ç–∞
        if task.status in ("rejected", "in_progress", "in_review"):
            if task.attempt >= task.max_attempts:
                task.status = "failed"
            else:
                task.status = "pending"
        
        if task.status in RETRIABLE_STATUSES:
            has_pending = True
            
        deps = [t for t in plan.tasks if t.id in task.depends_on]
        if any(d.status == "failed" for d in deps):
            task.status = "blocked"
            continue
            
        if task.status == "blocked":
            continue
            
        if task.status == "approved" or task.status == "failed":
            continue
            
        if all(d.status == "approved" for d in deps):
            all_blocked_or_failed = False
            return task

    # –ï—Å–ª–∏ –º—ã –∑–¥–µ—Å—å, –∑–Ω–∞—á–∏—Ç –≥–æ—Ç–æ–≤—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç.
    # –ï—Å–ª–∏ –µ—Å—Ç—å pending –∑–∞–¥–∞—á–∏, –Ω–æ –æ–Ω–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã (—Ü–∏–∫–ª? –±–∞–≥?) –∏–ª–∏ –∂–¥—É—Ç (–Ω–æ –º—ã –ø—Ä–æ–≤–µ—Ä–∏–ª–∏ deps)
    # –ï—Å–ª–∏ –≤—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ blocked –∏–ª–∏ failed ‚Äî –ø–ª–∞–Ω –ø—Ä–æ–≤–∞–ª–µ–Ω.
    if has_pending and all_blocked_or_failed:
        # Deadlock –∏–ª–∏ –∫–∞—Å–∫–∞–¥–Ω—ã–π –ø—Ä–æ–≤–∞–ª
        return None 
        
    return None
```

### 6.4. –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è `_decompose()`

```python
async def _decompose(self, user_goal: str, session: Session) -> ProjectPlan:
```

–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **—á–µ—Ä–µ–∑ CLI —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏** (`session.run_prompt`), –∞ –Ω–µ —á–µ—Ä–µ–∑ `chat_completion()`. –≠—Ç–æ –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ CLI:

- –í–∏–¥–∏—Ç —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–æ–∂–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- –ú–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å `git log`, `git status`, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤.
- –ú–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã/–ª–∏–Ω—Ç–µ—Ä –∏ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.
- –ú–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å `README`, `pyproject.toml`, —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç Manager –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç **—Å —Å–µ—Ä–µ–¥–∏–Ω—ã**: –µ—Å–ª–∏ —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã —É–∂–µ —Å–¥–µ–ª–∞–Ω–∞, CLI —ç—Ç–æ —É–≤–∏–¥–∏—Ç –∏ —Å–æ–∑–¥–∞—Å—Ç –∑–∞–¥–∞—á–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å—Ç–∞–≤—à—É—é—Å—è —á–∞—Å—Ç—å.

**–ê–ª–≥–æ—Ä–∏—Ç–º (–¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π):**

–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —Ñ–∞–∑: CLI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç (—Ñ–∞–∑–∞ 1), –∞ Agent –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∞–ª–∏–¥–Ω—ã–π JSON (—Ñ–∞–∑–∞ 2).

**–§–∞–∑–∞ 1 ‚Äî CLI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç:**

1. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç `DECOMPOSE_INSTRUCTION` (—Å–º. —Ä–∞–∑–¥–µ–ª 9.1), –≤ –∫–æ—Ç–æ—Ä–æ–º CLI –ø—Ä–æ—Å—è—Ç:
   - –ò–∑—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Ñ–∞–π–ª—ã, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, git, —Ç–µ—Å—Ç—ã).
   - –ù–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –∑–∞–¥–∞—á.
   - –í–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

2. –í—ã–∑–≤–∞—Ç—å `session.run_prompt(decompose_prompt)` ‚Üí –ø–æ–ª—É—á–∏—Ç—å `raw_output`.

**–§–∞–∑–∞ 2 ‚Äî –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**

3. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å `raw_output` –Ω–∞–ø—Ä—è–º—É—é –∫–∞–∫ JSON (–∏—â–µ–º –±–ª–æ–∫ `` ```json ... ``` ``).
4. –ï—Å–ª–∏ –ø—Ä—è–º–æ–π –ø–∞—Ä—Å–∏–Ω–≥ —É—Å–ø–µ—à–µ–Ω ‚Üí `ProjectPlan`.
5. –ï—Å–ª–∏ –Ω–µ —Ä–∞—Å–ø–∞—Ä—Å–∏–ª–æ—Å—å ‚Üí –≤—ã–∑–≤–∞—Ç—å Agent (`chat_completion`) —Å –ø—Ä–æ–º–ø—Ç–æ–º `DECOMPOSE_NORMALIZE_SYSTEM` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è JSON –∏–∑ —Ç–µ–∫—Å—Ç–∞.
6. –ï—Å–ª–∏ Agent –≤–µ—Ä–Ω—É–ª –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ Agent'–∞ (strict mode).
7. –ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Üí fallback (–ø–ª–∞–Ω –∏–∑ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏).

**–ü–æ—á–µ–º—É –¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**
- CLI –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —á—Ç–æ —É–≥–æ–¥–Ω–æ: JSON —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏, –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π JSON, markdown-—Ç–∞–±–ª–∏—Ü—É, —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–¥–∞—á. –ü—ã—Ç–∞—Ç—å—Å—è –ø–∞—Ä—Å–∏—Ç—å —ç—Ç–æ —Ä–µ–≥—É–ª—è—Ä–∫–∞–º–∏ ‚Äî –Ω–µ–Ω–∞–¥—ë–∂–Ω–æ.
- Agent (`chat_completion`) –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–æ—Å—Ç—É—é –∑–∞–¥–∞—á—É ¬´–∏–∑–≤–ª–µ–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ —Ç–µ–∫—Å—Ç–∞¬ª ‚Äî —ç—Ç–æ –µ–≥–æ —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞, –æ—à–∏–±–∫–∏ –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã.
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: CLI –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ** (–∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞), Agent ‚Äî –∑–∞ **—Ñ–æ—Ä–º–∞—Ç** (–≤–∞–ª–∏–¥–Ω—ã–π JSON).

**–¢–∞–π–º–∞—É—Ç—ã:**
- –§–∞–∑–∞ 1 (CLI): `manager_decompose_timeout_sec` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 300 —Å–µ–∫—É–Ω–¥ = 5 –º–∏–Ω—É—Ç).
- –§–∞–∑–∞ 2 (Agent): —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∞–π–º–∞—É—Ç `chat_completion` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60 —Å–µ–∫—É–Ω–¥).

```python
async def _decompose(self, user_goal: str, session: Session) -> ProjectPlan:
    # === –§–∞–∑–∞ 1: CLI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç ===
    prompt = self._build_decompose_prompt(user_goal)
    raw_output = await asyncio.wait_for(
        session.run_prompt(prompt),
        timeout=self._config.defaults.manager_decompose_timeout_sec,
    )
    raw_output = strip_ansi(raw_output)
    self._log.info("decompose phase 1 done: CLI output %d chars", len(raw_output))

    # === –ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ ===
    –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º json –ø–æ–¥—Å—Ç—Ä–æ–∫—É, –ø–æ—Ç–æ–º –ø—ã—Ç–∞–µ–º—Å—è –µ–µ –ø–∞—Ä—Å–∏—Ç—å:
    plan = self._try_parse_json(raw_output, user_goal)
    if plan:
        return plan

    # === –§–∞–∑–∞ 2: Agent –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç (–µ—Å–ª–∏ –ø—Ä—è–º–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è) ===
    # Agent –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–¥ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–∫—Å—Ç–∞, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    self._log.info("direct parse failed, invoking agent normalization")
    plan = await self._normalize_plan(raw_output, user_goal)
    if not plan:
        # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Å —É—Ç–æ—á–Ω–µ–Ω–∏–µ–º
        self._log.warning("decompose phase 2: first normalization failed, retrying")
        plan = await self._normalize_plan(raw_output, user_goal, strict=True)
    if not plan:
        # Fallback: –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞
        self._log.warning("decompose: all normalization failed, using single-task fallback")
        plan = ProjectPlan(
            project_goal=user_goal,
            tasks=[DevTask(
                id="task_1",
                title="–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É",
                description=user_goal,
                acceptance_criteria=["–ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞"],
            )],
        )
    return plan


async def _normalize_plan(
    self, cli_output: str, user_goal: str, strict: bool = False,
) -> Optional[ProjectPlan]:
    """–§–∞–∑–∞ 2: Agent –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω –∏–∑ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ CLI."""
    system = DECOMPOSE_NORMALIZE_SYSTEM
    if strict:
        system += "\n\n–ü–†–ï–î–´–î–£–©–ê–Ø –ü–û–ü–´–¢–ö–ê –ù–ï –†–ê–°–ü–ê–†–°–ò–õ–ê–°–¨. –í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON, –Ω–∏—á–µ–≥–æ –±–æ–ª—å—à–µ."
    user_msg = (
        f"–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞: {user_goal}\n\n"
        f"–û—Ç–≤–µ—Ç CLI (–∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–ª–∞–Ω):\n{cli_output}"
    )
    raw = await chat_completion(self._config, system, user_msg)
    if not raw:
        return None
    try:
        payload = json.loads(_extract_json_object(raw))
        return self._payload_to_plan(payload, user_goal)
    except Exception as e:
        self._log.warning("normalize_plan: JSON parse error: %s", e)
        return None
```

### 6.5. –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ `_delegate_develop()`

```python
async def _delegate_develop(self, task: DevTask, session: Session) -> str:
```

**–§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è CLI**, –≤–∫–ª—é—á–∞—é—â–∏–π:

1. –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (`task.description`).
2. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ (`task.acceptance_criteria`).
3. –ï—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è —Ä–µ–≤—å—é–µ—Ä–∞ (`task.rejection_history`) ‚Äî –≤–∫–ª—é—á–∏—Ç—å –∏—Ö –≤ –ø—Ä–æ–º–ø—Ç —Å –ø–æ–º–µ—Ç–∫–æ–π ¬´–ò—Å–ø—Ä–∞–≤—å —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:¬ª.
4. –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞: –∫–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (–∫—Ä–∞—Ç–∫–∏–π —Å–ø–∏—Å–æ–∫).
5. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∞—Ç—å –æ—Ç—á—ë—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ.

**–í—ã–∑—ã–≤–∞–µ—Ç** `session.run_prompt(dev_prompt)` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã–≤–æ–¥ CLI (strip ANSI).

**–û–±—Ä–µ–∑–∫–∞ `dev_report`:**
CLI –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π –≤—ã–≤–æ–¥ (–¥–µ—Å—è—Ç–∫–∏ –ö–ë). –ü–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ª–æ–≥, –Ω–æ –≤ `task.dev_report` (–∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç —Ä–µ–≤—å—é–µ—Ä–∞ –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ JSON) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ–±—Ä–µ–∑–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:
- –ï—Å–ª–∏ `len(output) <= 8000` —Å–∏–º–≤–æ–ª–æ–≤ ‚Äî —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ü–µ–ª–∏–∫–æ–º.
- –ï—Å–ª–∏ –±–æ–ª—å—à–µ ‚Äî –≤–∑—è—Ç—å –ø–µ—Ä–≤—ã–µ 3000 + –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5000 —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø–æ–º–µ—Ç–∫–æ–π `...(–æ–±—Ä–µ–∑–∞–Ω–æ {N} —Å–∏–º–≤–æ–ª–æ–≤)...` –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ.
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `manager_dev_report_max_chars: int = 8000` –≤ –∫–æ–Ω—Ñ–∏–≥–µ.

**–¢–∞–π–º–∞—É—Ç:** `manager_dev_timeout_sec` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 600 —Å–µ–∫—É–Ω–¥ = 10 –º–∏–Ω—É—Ç).

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- –ï—Å–ª–∏ CLI –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π ‚Üí `dev_report = "ERROR: {–æ–ø–∏—Å–∞–Ω–∏–µ}"`.
- –ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Üí `dev_report = "TIMEOUT: –ø—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è"`.

### 6.6. –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≤—å—é `_delegate_review()`

```python
async def _delegate_review(self, task: DevTask, session: Session, bot, context, dest) -> ReviewResult:
```

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π** `Executor.run()` —Å –ø—Ä–æ—Ñ–∏–ª–µ–º `reviewer`.

**–§–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è —Ä–µ–≤—å—é–µ—Ä–∞**, –≤–∫–ª—é—á–∞—é—â–∏–π:

1. –ò—Å—Ö–æ–¥–Ω–æ–µ –¢–ó –∑–∞–¥–∞—á–∏ (`task.description`).
2. –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏ (`task.acceptance_criteria`) ‚Äî —Ä–µ–≤—å—é–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ –Ω–∏–º.
3. –û—Ç—á—ë—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (`task.dev_report`) ‚Äî —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ.
4. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã, –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã/–ª–∏–Ω—Ç–µ—Ä –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ, –≤—ã–Ω–µ—Å—Ç–∏ –≤–µ—Ä–¥–∏–∫—Ç.
5. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: JSON `{"approved": true/false, "summary": "...", "comments": "...", "files_reviewed": [...]}`.

**–ü—Ä–æ—Ñ–∏–ª—å `reviewer`:** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ + —Ç–µ—Å—Ç—ã).

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:**
–í –ø—Ä–æ–º–ø—Ç —Ä–µ–≤—å—é–µ—Ä–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: ¬´–ï—Å–ª–∏ —Ñ–∞–π–ª—ã –±–æ–ª—å—à–∏–µ, —á–∏—Ç–∞–π –∏—Ö —á–∞—Å—Ç—è–º–∏ (read_file offset/limit) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π grep. –ù–µ –ø—ã—Ç–∞–π—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç —Ü–µ–ª–∏–∫–æ–º¬ª. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

**–ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–¥–≤—É—Ö—Ñ–∞–∑–Ω—ã–π, –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏):**

Executor –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `ExecutorResponse` —Å–æ —Å–≤–æ–±–æ–¥–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –≤ `summary`. –≠—Ç–æ—Ç —Ç–µ–∫—Å—Ç –Ω—É–∂–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ `ReviewResult`:

1. **–ü–æ–ø—ã—Ç–∫–∞ –ø—Ä—è–º–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞:** –µ—Å–ª–∏ –≤ `summary` –µ—Å—Ç—å JSON-–±–ª–æ–∫ ‚Äî –∏–∑–≤–ª–µ—á—å –∏ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å.
2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Agent:** –µ—Å–ª–∏ –ø—Ä—è–º–æ–π –ø–∞—Ä—Å–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è ‚Äî –≤—ã–∑–≤–∞—Ç—å `chat_completion()` —Å –ø—Ä–æ–º–ø—Ç–æ–º `REVIEW_NORMALIZE_SYSTEM` (—Å–º. —Ä–∞–∑–¥–µ–ª 9.3.1), –ø–µ—Ä–µ–¥–∞–≤ —Ç–µ–∫—Å—Ç —Ä–µ–≤—å—é–µ—Ä–∞. Agent –∏–∑–≤–ª–µ—á—ë—Ç –≤–µ—Ä–¥–∏–∫—Ç –∏ –≤–µ—Ä–Ω—ë—Ç —á–∏—Å—Ç—ã–π JSON.
3. **Fallback:** –µ—Å–ª–∏ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å ‚Üí `ReviewResult(approved=False, comments="–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–µ—Ä–¥–∏–∫—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞")`.

### 6.7. –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è `_make_decision()`

–≠—Ç–æ—Ç —ç—Ç–∞–ø **–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞** –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–µ—Ä–¥–∏–∫—Ç–∞ —Ä–µ–≤—å—é–µ—Ä–∞ (—Ä–∞–∑–¥–µ–ª 6.6). –≠—Ç–æ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –∞—Ä–±–∏—Ç—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É: –¢–ó + –æ—Ç—á—ë—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ + –≤–µ—Ä–¥–∏–∫—Ç —Ä–µ–≤—å—é–µ—Ä–∞. –û–Ω –Ω—É–∂–µ–Ω, –ø–æ—Ç–æ–º—É —á—Ç–æ:

- –†–µ–≤—å—é–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∏–º (–æ—Ç–∫–ª–æ–Ω—è—Ç—å —Ä–∞–±–æ—á–∏–π –∫–æ–¥ –∏–∑-–∑–∞ —Å—Ç–∏–ª—è).
- –†–µ–≤—å—é–µ—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø—Ä–∏—ë–º–∫–∏.
- –ê—Ä–±–∏—Ç—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –∏–º–µ–Ω–Ω–æ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø—Ä–∏—ë–º–∫–∏, –∞ –Ω–µ –ø–æ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–º—É –∫–∞—á–µ—Å—Ç–≤—É.

```python
async def _make_decision(self, task: DevTask, dev_report: str, review: ReviewResult) -> Dict[str, Any]:
```

–í—ã–∑—ã–≤–∞–µ—Ç `chat_completion()` —Å –ø—Ä–æ–º–ø—Ç–æ–º `DECISION_SYSTEM` (—Å–º. —Ä–∞–∑–¥–µ–ª 9.5):
- –í–æ—Ç –∑–∞–¥–∞—á–∞ —Å –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ –ø—Ä–∏—ë–º–∫–∏, –≤–æ—Ç –æ—Ç—á—ë—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞, –≤–æ—Ç –≤–µ—Ä–¥–∏–∫—Ç —Ä–µ–≤—å—é–µ—Ä–∞.
- –†–µ—à–∏: approved –∏–ª–∏ rejected **–ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø—Ä–∏—ë–º–∫–∏**.
- –ï—Å–ª–∏ rejected ‚Äî –ø–µ—Ä–µ—á–∏—Å–ª–∏ **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏** –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"verdict": "approved"|"rejected", "reasons": [...]}`.

### 6.8. –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç `_compose_final_report()`

```python
async def _compose_final_report(self, plan: ProjectPlan) -> str:
```

–í—ã–∑—ã–≤–∞–µ—Ç `chat_completion()` —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –≤—Å–µ—Ö –∑–∞–¥–∞—á–∞—Ö, –∏—Ö —Å—Ç–∞—Ç—É—Å–∞—Ö –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö. LLM —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π Markdown-–æ—Ç—á—ë—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### 6.9. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ `_notify_progress()`

–ù–∞ –∫–∞–∂–¥–æ–º –∑–Ω–∞—á–∏–º–æ–º —Å–æ–±—ã—Ç–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram:

```
üìã –ü—Ä–æ–µ–∫—Ç: ¬´–°–æ–∑–¥–∞—Ç—å REST API –¥–ª—è –±–ª–æ–≥–∞¬ª
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ 1/5 –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö ‚Äî –≥–æ—Ç–æ–≤–æ
üîÑ 2/5 CRUD —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã ‚Äî —Ä–µ–≤—å—é (–ø–æ–ø—ã—Ç–∫–∞ 2)
‚è≥ 3/5 –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ
‚è≥ 4/5 –¢–µ—Å—Ç—ã ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ
‚è≥ 5/5 –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî –æ–∂–∏–¥–∞–Ω–∏–µ
```

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è:
- `in_progress` ‚Üí ¬´üîß –ù–∞—á–∏–Ω–∞—é –∑–∞–¥–∞—á—É N: {title}¬ª
- `in_review` ‚Üí ¬´üîç –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Ä–µ–≤—å—é: {title}¬ª
- `approved` ‚Üí ¬´‚úÖ –ü—Ä–∏–Ω—è—Ç–æ: {title}¬ª
- `rejected` ‚Üí ¬´üîÑ –î–æ—Ä–∞–±–æ—Ç–∫–∞: {title} ‚Äî {–∫—Ä–∞—Ç–∫–∏–µ_–∑–∞–º–µ—á–∞–Ω–∏—è}¬ª
- `failed` ‚Üí ¬´‚ùå –ü—Ä–æ–≤–∞–ª: {title}¬ª
- `blocked` ‚Üí ¬´‚õî –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: {title}¬ª

## 7. –ü—Ä–æ—Ñ–∏–ª–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (`agent/profiles.py`)

### 7.1. –ü—Ä–æ—Ñ–∏–ª—å reviewer

```python
REVIEWER_PROFILE = ExecutorProfile(
    name="reviewer",
    allowed_tools=[
        "read_file",
        "list_directory",
        "search_files",
        "search_text",
        "run_command",      # –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏ –ª–∏–Ω—Ç–µ—Ä–∞
    ],
    timeout_ms=300_000,     # 5 –º–∏–Ω—É—Ç
    max_retries=1,
)
```

**–í–∞–∂–Ω–æ:** –≤ –ø—Ä–æ—Ñ–∏–ª–µ `reviewer` **–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç** –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∑–∞–ø–∏—Å–∏: `write_file`, `edit_file`, `delete_file`, `send_file`, `use_cli`. –†–µ–≤—å—é–µ—Ä –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã.

### 7.2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è

–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `build_reviewer_profile()` –≤ `agent/profiles.py`:

```python
def build_reviewer_profile(config: AppConfig, tool_registry: ToolRegistry) -> ExecutorProfile:
    available = set(tool_registry.list_tool_names())
    reviewer_tools = [
        "read_file", "list_directory", "search_files", "search_text", "run_command",
    ]
    # –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
    tools = [t for t in reviewer_tools if t in available]
    timeout_sec = getattr(config.defaults, "manager_review_timeout_sec", 300)
    return ExecutorProfile(name="reviewer", allowed_tools=tools, timeout_ms=timeout_sec * 1000)
```

## 8. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (`agent/manager_store.py`)

### 8.1. –§–∞–π–ª –ø–ª–∞–Ω–∞

–ü–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `MANAGER_PLAN.json` –≤–Ω—É—Ç—Ä–∏ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–µ—Å—Å–∏–∏ (`session.workdir` –∏–ª–∏ `sandbox_root`).

### 8.2. –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞

```json
{
  "project_goal": "–°–æ–∑–¥–∞—Ç—å REST API –Ω–∞ FastAPI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏",
  "analysis": {
    "current_state": "–ü—É—Å—Ç–æ–π –∫–∞—Ç–∞–ª–æ–≥, —Ç–æ–ª—å–∫–æ .gitignore",
    "already_done": [],
    "remaining_work": ["–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞", "–ú–æ–¥–µ–ª–∏", "–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã", "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è", "–¢–µ—Å—Ç—ã"]
  },
  "status": "active",
  "created_at": "2026-02-07T14:30:00",
  "updated_at": "2026-02-07T15:12:00",
  "current_task_id": "task_2",
  "tasks": [
    {
      "id": "task_1",
      "title": "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–æ–¥–µ–ª–∏",
      "description": "...",
      "acceptance_criteria": ["..."],
      "depends_on": [],
      "status": "approved",
      "attempt": 1,
      "max_attempts": 3,
      "dev_report": "...",
      "review_verdict": "approved",
      "review_comments": null,
      "rejection_history": [],
      "started_at": "2026-02-07T14:31:00",
      "completed_at": "2026-02-07T14:38:00"
    },
    {
      "id": "task_2",
      "title": "CRUD —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã",
      "description": "...",
      "acceptance_criteria": ["..."],
      "depends_on": ["task_1"],
      "status": "in_review",
      "attempt": 2,
      "max_attempts": 3,
      "dev_report": "...",
      "review_verdict": null,
      "review_comments": null,
      "rejection_history": [
        {
          "attempt": 1,
          "comments": "–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.",
          "timestamp": "2026-02-07T14:52:00"
        }
      ],
      "started_at": "2026-02-07T14:40:00",
      "completed_at": null
    }
  ]
}
```

### 8.3. –§—É–Ω–∫—Ü–∏–∏

```python
def save_plan(cwd: str, plan: ProjectPlan) -> None:
    """–ê—Ç–æ–º–∞—Ä–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω –≤ MANAGER_PLAN.json."""

def load_plan(cwd: str) -> Optional[ProjectPlan]:
    """–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω –∏–∑ MANAGER_PLAN.json. –í–µ—Ä–Ω—É—Ç—å None, –µ—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç."""

def delete_plan(cwd: str) -> None:
    """–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ø–ª–∞–Ω–∞ (–ø—Ä–∏ /manager reset)."""

def archive_plan(cwd: str, plan: ProjectPlan) -> None:
    """–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å MANAGER_PLAN.json –≤ archive/MANAGER_PLAN_{date}_{status}.json."""
    # –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É .manager_archive, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç—É–¥–∞ –∫–æ–ø–∏—é, —É–¥–∞–ª–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª.
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `update_json_locked` / `read_json_locked` –∏–∑ `agent/session_store.py` –¥–ª—è –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç–∏.

### 8.4. –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ manager-—Ä–µ–∂–∏–º–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å `MANAGER_PLAN.json`.
2. –ï—Å–ª–∏ –ø–ª–∞–Ω `status == "active"` –∏ –µ—Å—Ç—å –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏.
3. –ï—Å–ª–∏ –ø–ª–∞–Ω `status == "completed"` –∏–ª–∏ `"failed"` ‚Üí –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω (CLI –∑–∞–Ω–æ–≤–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç).
4. –ï—Å–ª–∏ –ø–ª–∞–Ω `status == "paused"` ‚Üí –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–ª–∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.

### 8.5. –†—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

–ö–æ–º–∞–Ω–¥–∞ `/manager reset` –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ ¬´–°–±—Ä–æ—Å–∏—Ç—å –ø–ª–∞–Ω¬ª:
1. –£–¥–∞–ª–∏—Ç—å `MANAGER_PLAN.json`.
2. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ CLI –∑–∞–Ω–æ–≤–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–µ–∫—Ç –∏ —Å—Ç—Ä–æ–∏—Ç –ø–ª–∞–Ω.

–≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω—ë—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é (–≤–Ω–µ Manager) –∏ —Ö–æ—á–µ—Ç, —á—Ç–æ–±—ã Manager –∏—Ö —É—á—ë–ª.
- –ü—Ä–µ–¥—ã–¥—É—â–∏–π –ø–ª–∞–Ω –±—ã–ª –Ω–µ—É–¥–∞—á–Ω—ã–º –∏ –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–æ—Ü–µ–Ω–∫–∞.

## 9. –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã (`agent/manager_prompts.py`)

### 9.1. –ü—Ä–æ–º–ø—Ç –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ `DECOMPOSE_INSTRUCTION`

–≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ **CLI** —á–µ—Ä–µ–∑ `session.run_prompt()`. CLI –≤–∏–¥–∏—Ç —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–æ–∂–µ—Ç –æ—Ü–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

```
## –ó–∞–¥–∞–Ω–∏–µ: –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∑–∞–¥–∞—á–∏

### –¶–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
{user_goal}

### –ß—Ç–æ –æ—Ç —Ç–µ–±—è —Ç—Ä–µ–±—É–µ—Ç—Å—è:

**–®–∞–≥ 1 ‚Äî –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞:**
- –ò–∑—É—á–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤ –∏ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ (ls, find, tree).
- –ü–æ—Å–º–æ—Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã: README, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞.
- –ü—Ä–æ–≤–µ—Ä—å git status –∏ git log (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã).
- –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç—ã ‚Äî –∑–∞–ø—É—Å—Ç–∏ –∏—Ö –∏ –ø—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç.
- –ï—Å–ª–∏ –µ—Å—Ç—å package manager (requirements.txt, package.json, go.mod) ‚Äî –ø—Ä–æ–≤–µ—Ä—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
- –û–ø—Ä–µ–¥–µ–ª–∏, –∫–∞–∫–∞—è —á–∞—Å—Ç—å —Ä–∞–±–æ—Ç—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –∞ —á—Ç–æ –µ—â—ë –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å.

**–®–∞–≥ 2 ‚Äî –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞ –∑–∞–¥–∞—á–∏:**
–ù–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ—Å—Ç–∞–≤—å –ø–ª–∞–Ω –∑–∞–¥–∞—á.
–£—á—Ç–∏ —Ç–æ, —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ ‚Äî –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –∑–∞–¥–∞—á–∏ –Ω–∞ —Ç–æ, —á—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.
–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø—É—Å—Ç ‚Äî —Å–æ–∑–¥–∞–π –ø–ª–∞–Ω —Å –Ω—É–ª—è.
–ï—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –Ω–∞–ø–æ–ª–æ–≤–∏–Ω—É –≥–æ—Ç–æ–≤ ‚Äî —Å–æ–∑–¥–∞–π –∑–∞–¥–∞—á–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å—Ç–∞–≤—à—É—é—Å—è —á–∞—Å—Ç—å.

### –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∑–∞–¥–∞—á:
- –ö–∞–∂–¥–∞—è –∑–∞–¥–∞—á–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ–π: –æ–¥–∏–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å
  –µ—ë –∑–∞ –æ–¥–Ω—É –∏—Ç–µ—Ä–∞—Ü–∏—é.
- description ‚Äî —ç—Ç–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –¢–ó –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞. –û–Ω –Ω–µ –≤–∏–¥–∏—Ç –¥—Ä—É–≥–∏–µ
  –∑–∞–¥–∞—á–∏ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –ø–æ —ç—Ç–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é. –í–∫–ª—é—á–∏ –≤ description
  –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤, —Ñ—É–Ω–∫—Ü–∏–π, –∫–ª–∞—Å—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å.
- acceptance_criteria ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –ø—É–Ω–∫—Ç—ã (—Ñ–∞–π–ª X —Å—É—â–µ—Å—Ç–≤—É–µ—Ç,
  —Ç–µ—Å—Ç Y –ø—Ä–æ—Ö–æ–¥–∏—Ç, —ç–Ω–¥–ø–æ–∏–Ω—Ç Z –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200).
- depends_on ‚Äî ID –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω—ã –î–û —ç—Ç–æ–π.
- –ü–æ—Ä—è–¥–æ–∫: —Å–Ω–∞—á–∞–ª–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, –ø–æ—Ç–æ–º –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∏.
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á: 2-10.

### –í–∞–∂–Ω–æ:
- –ù–ï —Å–æ–∑–¥–∞–≤–∞–π –∑–∞–¥–∞—á–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ó–∞–¥–∞—á–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–∏–º—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ.

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø–ª–∞–Ω –∑–∞–¥–∞—á –°–¢–†–û–ì–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.
–ù–∏–∫–∞–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ JSON-–±–ª–æ–∫–∞.

```json
{
  "project_analysis": {
    "current_state": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞",
    "already_done": ["–ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ"],
    "remaining_work": ["–ß—Ç–æ –µ—â—ë –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å"]
  },
  "tasks": [
    {
      "id": "task_1",
      "title": "–ö–æ—Ä–æ—Ç–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
      "description": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –¢–ó –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞...",
      "acceptance_criteria": [
        "–§–∞–π–ª X —Å–æ–∑–¥–∞–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç ...",
        "–¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç: pytest tests/..."
      ],
      "depends_on": []
    }
  ]
}
```

–í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¢–û–õ–¨–ö–û –≤–∞–ª–∏–¥–Ω—ã–π JSON. –ù–∏–∫–∞–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, markdown –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤–Ω–µ JSON.
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ø—Ä–æ–º–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –æ—Ç CLI —Å—Ç—Ä–æ–≥–∏–π JSON. –ï—Å–ª–∏ CLI –≤—Å—ë –∂–µ –≤–µ—Ä–Ω—ë—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –æ—Ç–≤–µ—Ç (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤–æ–∫—Ä—É–≥ JSON, –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –∏ —Ç.–ø.), —Ñ–∞–∑–∞ 2 –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Agent (—Ä–∞–∑–¥–µ–ª 6.4) —Å–ª—É–∂–∏—Ç —Å—Ç—Ä–∞—Ö–æ–≤–∫–æ–π.

### 9.1.1. –ü—Ä–æ–º–ø—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ `DECOMPOSE_NORMALIZE_SYSTEM`

–≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `chat_completion()` –Ω–∞ —Ñ–∞–∑–µ 2 ‚Äî Agent –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç CLI –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∏–∑ –Ω–µ–≥–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON.

```
–¢—ã –ø–æ–ª—É—á–∏—à—å —Ç–µ–∫—Å—Ç ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø–ª–∞–Ω –∑–∞–¥–∞—á –æ—Ç –¥—Ä—É–≥–æ–≥–æ
–ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞. –¢–≤–æ—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞: –∏–∑–≤–ª–µ—á—å –∏–∑ —ç—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –≤–µ—Ä–Ω—É—Ç—å –∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

–ù–ï –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –ø—Ä–æ–µ–∫—Ç —Å–∞–º. –ù–ï –¥–æ–±–∞–≤–ª—è–π –∑–∞–¥–∞—á–∏ –æ—Ç —Å–µ–±—è. –ù–ï –º–µ–Ω—è–π
—Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ ‚Äî —Ç–æ–ª—å–∫–æ –Ω–æ—Ä–º–∞–ª–∏–∑—É–π —Ñ–æ—Ä–º–∞—Ç.

–í–µ—Ä–Ω–∏ —Å—Ç—Ä–æ–≥–æ JSON:
{
  "project_analysis": {
    "current_state": "–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞",
    "already_done": ["–ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–∏–∑ —Ç–µ–∫—Å—Ç–∞)"],
    "remaining_work": ["–ß—Ç–æ –µ—â—ë –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç (–∏–∑ —Ç–µ–∫—Å—Ç–∞)"]
  },
  "tasks": [
    {
      "id": "task_1",
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏",
      "description": "–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞",
      "acceptance_criteria": ["–ö—Ä–∏—Ç–µ—Ä–∏–π 1", "–ö—Ä–∏—Ç–µ—Ä–∏–π 2"],
      "depends_on": []
    }
  ]
}

–ü—Ä–∞–≤–∏–ª–∞:
- –ò–∑–≤–ª–µ–∫–∏ –í–°–ï –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–ø–∏—Å–∞–Ω—ã –≤ —Ç–µ–∫—Å—Ç–µ. –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π.
- –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç —è–≤–Ω—ã—Ö id ‚Äî –Ω–∞–∑–Ω–∞—á—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ: task_1, task_2, ...
- –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç —è–≤–Ω—ã—Ö acceptance_criteria ‚Äî —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –∏—Ö –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è
  –∑–∞–¥–∞—á–∏ (—á—Ç–æ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å).
- –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚Äî –æ—Å—Ç–∞–≤—å depends_on –ø—É—Å—Ç—ã–º.
- –ï—Å–ª–∏ –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ –æ–ø–∏—Å–∞–Ω –Ω–µ—á—ë—Ç–∫–æ ‚Äî –∏–∑–≤–ª–µ–∫–∏ –º–∞–∫—Å–∏–º—É–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¢–û–õ–¨–ö–û JSON. –ù–∏–∫–∞–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ.
```

### 9.2. –ü—Ä–æ–º–ø—Ç –¥–ª—è developer'–∞ (—à–∞–±–ª–æ–Ω `DEV_INSTRUCTION_TEMPLATE`)

```
## –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É

### –ó–∞–¥–∞—á–∞: {task.title}

{task.description}

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
{formatted_criteria}

{rejection_block}

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞
–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è: {analysis.current_state}
–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ: {analysis.already_done}
–†–∞–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏: {completed_tasks_summary}

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –í—ã–ø–æ–ª–Ω–∏ –∑–∞–¥–∞—á—É –ø–æ–ª–Ω–æ—Å—Ç—å—é.
- –°–æ–∑–¥–∞–π/–∏–∑–º–µ–Ω–∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏.
- –£—á–∏—Ç—ã–≤–∞–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞.
- **–†–∞–±–æ—Ç–∞–µ–º –∞–≤—Ç–æ–Ω–æ–º–Ω–æ**: –ù–ï —Å–ø—Ä–∞—à–∏–≤–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø—Ä–∏–Ω–∏–º–∞–π —Ä–µ—à–µ–Ω–∏—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ‚Äî —Å–¥–µ–ª–∞–π —Ä–∞–∑—É–º–Ω–æ–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ.
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∞–π –∫—Ä–∞—Ç–∫–∏–π –æ—Ç—á—ë—Ç: —á—Ç–æ —Å–æ–∑–¥–∞–Ω–æ/–∏–∑–º–µ–Ω–µ–Ω–æ, –∫–∞–∫–∏–µ —Ñ–∞–π–ª—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã.
```

–ë–ª–æ–∫ `{rejection_block}` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–µ:
```
### ‚ö†Ô∏è –ó–∞–º–µ—á–∞–Ω–∏—è —Ä–µ–≤—å—é–µ—Ä–∞ (–∏—Å–ø—Ä–∞–≤—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
{review_comments}

–≠—Ç–æ –ø–æ–ø—ã—Ç–∫–∞ {attempt} –∏–∑ {max_attempts}. –ò—Å–ø—Ä–∞–≤—å –≤—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è.
```

### 9.3. –ü—Ä–æ–º–ø—Ç –¥–ª—è reviewer'–∞ `REVIEW_INSTRUCTION_TEMPLATE`

```
## –ó–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ä–µ–≤—å—é

### –ó–∞–¥–∞—á–∞: {task.title}

### –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (–¢–ó):
{task.description}

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏:
{formatted_criteria}

### –û—Ç—á—ë—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
{dev_report}

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–≤—å—é:
1. –ü—Ä–æ—á–∏—Ç–∞–π —Ñ–∞–π–ª—ã, —É–ø–æ–º—è–Ω—É—Ç—ã–µ –≤ –æ—Ç—á—ë—Ç–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.
2. –ü—Ä–æ–≤–µ—Ä—å –∫–∞–∂–¥—ã–π –∫—Ä–∏—Ç–µ—Ä–∏–π –ø—Ä–∏—ë–º–∫–∏.
3. –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç—ã ‚Äî –∑–∞–ø—É—Å—Ç–∏ –∏—Ö (`run_command`).
4. –ï—Å–ª–∏ –µ—Å—Ç—å –ª–∏–Ω—Ç–µ—Ä ‚Äî –∑–∞–ø—É—Å—Ç–∏.
5. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ –∫–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é –∑–∞–¥–∞—á–∏.

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (—Å—Ç—Ä–æ–≥–æ JSON):
{
  "approved": true –∏–ª–∏ false,
  "summary": "–ö—Ä–∞—Ç–∫–∏–π –∏—Ç–æ–≥ —Ä–µ–≤—å—é",
  "comments": "–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è (–µ—Å–ª–∏ rejected)",
  "files_reviewed": ["—Ñ–∞–π–ª1.py", "—Ñ–∞–π–ª2.py"],
  "tests_passed": true –∏–ª–∏ false –∏–ª–∏ null
}
```

### 9.3.1. –ü—Ä–æ–º–ø—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–≤—å—é `REVIEW_NORMALIZE_SYSTEM`

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `chat_completion()` –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≤–µ—Ä–¥–∏–∫—Ç–∞ –∏–∑ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Ä–µ–≤—å—é–µ—Ä–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ `DECOMPOSE_NORMALIZE_SYSTEM`).

```
–¢—ã –ø–æ–ª—É—á–∏—à—å —Ç–µ–∫—Å—Ç ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–≤—å—é –∫–æ–¥–∞ –æ—Ç –¥—Ä—É–≥–æ–≥–æ –ò–ò-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞.
–ò–∑–≤–ª–µ–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–µ—Ä–¥–∏–∫—Ç –∏ –≤–µ—Ä–Ω–∏ —Å—Ç—Ä–æ–≥–æ JSON:
{
  "approved": true –∏–ª–∏ false,
  "summary": "–ö—Ä–∞—Ç–∫–∏–π –∏—Ç–æ–≥ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)",
  "comments": "–ü–æ–¥—Ä–æ–±–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è ‚Äî —á—Ç–æ –Ω–µ —Ç–∞–∫ –∏ —á—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–µ—Å–ª–∏ rejected). –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –µ—Å–ª–∏ approved.",
  "files_reviewed": ["—Ñ–∞–π–ª1.py", "—Ñ–∞–π–ª2.py"],
  "tests_passed": true –∏–ª–∏ false –∏–ª–∏ null
}

–ü—Ä–∞–≤–∏–ª–∞:
- –ï—Å–ª–∏ —Ä–µ–≤—å—é–µ—Ä —è–≤–Ω–æ –æ–¥–æ–±—Ä–∏–ª —Ä–∞–±–æ—Ç—É (—Å–ª–æ–≤–∞: –æ–¥–æ–±—Ä–µ–Ω–æ, approved, –≤—Å—ë –æ–∫, –ø—Ä–∏–Ω—è—Ç–æ,
  —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫—Ä–∏—Ç–µ—Ä–∏—è–º) ‚Üí approved=true.
- –ï—Å–ª–∏ –µ—Å—Ç—å –ª—é–±—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è, –ø—Ä–æ–±–ª–µ–º—ã, –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫—Ä–∏—Ç–µ—Ä–∏—è–º ‚Üí approved=false.
- –ï—Å–ª–∏ –Ω–µ—è—Å–Ω–æ ‚Äî —Å—Ç–∞–≤—å approved=false (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ –≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É).
- –ù–ï –¥–æ–±–∞–≤–ª—è–π —Å–≤–æ–∏—Ö –∑–∞–º–µ—á–∞–Ω–∏–π. –¢–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Å–∫–∞–∑–∞–ª —Ä–µ–≤—å—é–µ—Ä.
- –û—Ç–≤–µ—Ç ‚Äî –¢–û–õ–¨–ö–û JSON.
```

### 9.4. –ü—Ä–æ–º–ø—Ç –∞—Ä–±–∏—Ç—Ä–∞ `DECISION_SYSTEM`

```
–¢—ã ‚Äî –∞—Ä–±–∏—Ç—Ä –ø—Ä–æ–µ–∫—Ç–∞. –ü—Ä–∏–Ω–∏–º–∞–µ—à—å —Ä–µ—à–µ–Ω–∏–µ: –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–ª–∏ –Ω–µ—Ç.

–î–∞–Ω–Ω—ã–µ:
- –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏.
- –û—Ç—á—ë—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (—á—Ç–æ –æ–Ω —Å–¥–µ–ª–∞–ª).
- –í–µ—Ä–¥–∏–∫—Ç —Ä–µ–≤—å—é–µ—Ä–∞ (–æ–¥–æ–±—Ä–∏–ª/–æ—Ç–∫–ª–æ–Ω–∏–ª + –∑–∞–º–µ—á–∞–Ω–∏—è).

–ü—Ä–∞–≤–∏–ª–∞:
- –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞–π –°–¢–†–û–ì–û –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –ø—Ä–∏—ë–º–∫–∏, –∞ –Ω–µ –ø–æ —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω–æ–º—É
  –∫–∞—á–µ—Å—Ç–≤—É –∫–æ–¥–∞.
- –ï—Å–ª–∏ –≤—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Äî approved, –¥–∞–∂–µ –µ—Å–ª–∏ —Ä–µ–≤—å—é–µ—Ä —É–∫–∞–∑–∞–ª
  –º–µ–ª–∫–∏–µ –∑–∞–º–µ—á–∞–Ω–∏—è –ø–æ —Å—Ç–∏–ª—é.
- –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫—Ä–∏—Ç–µ—Ä–∏–π –ù–ï –≤—ã–ø–æ–ª–Ω–µ–Ω ‚Äî rejected.
- –ü—Ä–∏ rejected –ø–µ—Ä–µ—á–∏—Å–ª–∏ –ö–û–ù–ö–†–ï–¢–ù–´–ï –Ω–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏.

–í–µ—Ä–Ω–∏ —Å—Ç—Ä–æ–≥–æ JSON:
{"verdict": "approved" –∏–ª–∏ "rejected", "reasons": ["–ø—Ä–∏—á–∏–Ω–∞1", "–ø—Ä–∏—á–∏–Ω–∞2"]}
```

### 9.5. –ü—Ä–æ–º–ø—Ç –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞ `FINAL_REPORT_SYSTEM`

```
–¢—ã ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞. –°—Ñ–æ—Ä–º–∏—Ä—É–π –∏—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–ü—Ä–∞–≤–∏–ª–∞:
- –ù–µ –æ–ø–∏—Å—ã–≤–∞–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã (—Ä–µ–≤—å—é, –ø–æ–ø—ã—Ç–∫–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã).
- –ü–µ—Ä–µ—á–∏—Å–ª–∏, —á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ.
- –ï—Å–ª–∏ –±—ã–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã/failed –∑–∞–¥–∞—á–∏ ‚Äî –∫—Ä–∞—Ç–∫–æ —É–∫–∞–∂–∏.
- –î–∞–π —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º —à–∞–≥–∞–º (–µ—Å–ª–∏ —É–º–µ—Å—Ç–Ω–æ).
- –§–æ—Ä–º–∞—Ç: Markdown —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ —Å–ø–∏—Å–∫–∞–º–∏.
```

## 10. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 10.1. –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `DefaultsConfig` (`config.py`)

```python
@dataclasses.dataclass
class DefaultsConfig:
    ...
    # Manager mode
    manager_max_tasks: int = 10             # –ú–∞–∫—Å–∏–º—É–º –∑–∞–¥–∞—á –≤ –ø–ª–∞–Ω–µ
    manager_max_attempts: int = 3           # –ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –∑–∞–¥–∞—á—É
    manager_decompose_timeout_sec: int = 300  # –¢–∞–π–º–∞—É—Ç –Ω–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é/–∞–Ω–∞–ª–∏–∑ (—Å–µ–∫—É–Ω–¥—ã)
    manager_dev_timeout_sec: int = 600      # –¢–∞–π–º–∞—É—Ç –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É (—Å–µ–∫—É–Ω–¥—ã)
    manager_review_timeout_sec: int = 300   # –¢–∞–π–º–∞—É—Ç –Ω–∞ —Ä–µ–≤—å—é (—Å–µ–∫—É–Ω–¥—ã)
    manager_dev_report_max_chars: int = 8000  # –ú–∞–∫—Å. –¥–ª–∏–Ω–∞ dev_report –¥–ª—è —Ä–µ–≤—å—é
    manager_auto_resume: bool = True        # –ê–≤—Ç–æ–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–∞
```

### 10.2. –°–µ–∫—Ü–∏—è –≤ `config_example.yaml`

```yaml
defaults:
  ...
  # Manager mode
  manager_max_tasks: 10
  manager_max_attempts: 3
  manager_decompose_timeout_sec: 300
  manager_dev_timeout_sec: 600
  manager_review_timeout_sec: 300
  manager_dev_report_max_chars: 8000
  manager_auto_resume: true
```

## 11. –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

### 11.1. –ö–æ–º–∞–Ω–¥–∞ `/manager`

–î–æ–±–∞–≤–∏—Ç—å –≤ `command_registry.py`:

```python
{"name": "manager", "desc": "–†–µ–∂–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.", "handler": bot_app.cmd_manager, "menu": True},
```

### 11.2. –ü–æ–≤–µ–¥–µ–Ω–∏–µ `/manager`

–ë–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤: –ø–æ–∫–∞–∑–∞—Ç—å inline-–º–µ–Ω—é:

```
üèó –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–†–µ–∂–∏–º: –≤—ã–∫–ª—é—á–µ–Ω

[–í–∫–ª—é—á–∏—Ç—å] [–í—ã–∫–ª—é—á–∏—Ç—å]
[–°—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∞] [–°–±—Ä–æ—Å–∏—Ç—å –ø–ª–∞–Ω]
```

–ï—Å–ª–∏ manager –≤–∫–ª—é—á—ë–Ω –∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω:

```
üèó –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–†–µ–∂–∏–º: –≤–∫–ª—é—á—ë–Ω
–ü–ª–∞–Ω: 3/5 –∑–∞–¥–∞—á –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

[–í—ã–∫–ª—é—á–∏—Ç—å]
[–°—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∞] [–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å] [–°–±—Ä–æ—Å–∏—Ç—å –ø–ª–∞–Ω]
```

### 11.3. Callback'–∏

| Callback data | –î–µ–π—Å—Ç–≤–∏–µ |
|--------------|----------|
| `manager_set:on` | –í–∫–ª—é—á–∏—Ç—å manager (`manager_enabled=True`, `agent_enabled=False`) |
| `manager_set:off` | –í—ã–∫–ª—é—á–∏—Ç—å manager (`manager_enabled=False`) |
| `manager_status` | –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∑–∞–¥–∞—á |
| `manager_pause` | –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (`plan.status = "paused"`) |
| `manager_reset` | –£–¥–∞–ª–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø–ª–∞–Ω, –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ |

### 11.4. –°—Ç–∞—Ç—É—Å –ø–ª–∞–Ω–∞ `manager_status`

–í—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é —Ç–∞–±–ª–∏—Ü—É:

```
üìã –ü–ª–∞–Ω: ¬´–°–æ–∑–¥–∞—Ç—å REST API –¥–ª—è –±–ª–æ–≥–∞¬ª
–°—Ç–∞—Ç—É—Å: active | –°–æ–∑–¥–∞–Ω: 2026-02-07 14:30

1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ [approved, –ø–æ–ø—ã—Ç–∫–∞ 1]
2. üîÑ CRUD —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã [in_review, –ø–æ–ø—ã—Ç–∫–∞ 2]
   ‚îî –ó–∞–º–µ—á–∞–Ω–∏–µ: –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. ‚è≥ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è [pending, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç: 1, 2]
4. ‚è≥ –¢–µ—Å—Ç—ã [pending, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç: 2, 3]
5. ‚è≥ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è [pending, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç: 1-4]
```

## 12. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bot.py`

### 12.1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

–í `__init__` –∫–ª–∞—Å—Å–∞ `BotApp`:

```python
from agent.manager import ManagerOrchestrator

self.manager_orchestrator = ManagerOrchestrator(config)
```

### 12.2. –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

–í `_handle_user_input`:

```python
async def _handle_user_input(self, session, text, chat_id, context, dest=None):
    if session.manager_enabled:
        await self._handle_manager_input(session, text, chat_id, context, dest=dest)
    elif session.agent_enabled:
        await self._handle_agent_input(session, text, chat_id, context, dest=dest)
    else:
        await self._handle_cli_input(session, text, chat_id, context, dest=dest)
```

### 12.3. –ú–µ—Ç–æ–¥ `_handle_manager_input`

```python
async def _handle_manager_input(self, session, text, chat_id, context, dest=None):
    dest = dest or {"kind": "telegram", "chat_id": chat_id}
    if session.busy:
        # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ agent: –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –æ—á–µ—Ä–µ–¥—å
        await self._offer_queue_or_cancel(session, text, chat_id, context, dest)
        return
    self._start_manager_task(session, text, dest, context)
```

### 12.4. –ú–µ—Ç–æ–¥ `run_manager`

–ê–Ω–∞–ª–æ–≥–∏—á–µ–Ω `run_agent`, –Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç `manager_orchestrator.run()`:

```python
async def run_manager(self, session, prompt, dest, context):
    async with session.run_lock:
        session.busy = True
        session.started_at = time.time()
        try:
            output = await self.manager_orchestrator.run(
                session, prompt, self, context, dest
            )
            # Manager —Å–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç
            session.state_summary = build_preview(output, ...)
        except asyncio.CancelledError:
            await self._send_message(context, chat_id=dest["chat_id"], text="–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–µ—Ä–≤–∞–Ω.")
            raise
        except Exception as e:
            await self._send_message(context, chat_id=dest["chat_id"], text=f"–û—à–∏–±–∫–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞: {e}")
        finally:
            session.busy = False
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
            if session.queue:
                next_item = session.queue.popleft()
                ...
```

### 12.5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏

–ö–æ–≥–¥–∞ manager –∑–∞–≤–µ—Ä—à–∏–ª —Ç–µ–∫—É—â–∏–π –∑–∞–ø—Ä–æ—Å –∏ –≤ –æ—á–µ—Ä–µ–¥–∏ –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ. –£—á–µ—Å—Ç—å, —á—Ç–æ –≤ manager-—Ä–µ–∂–∏–º–µ –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω (–µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–≤–µ—Ä—à—ë–Ω) –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–ª–∞–Ω–∞.

## 13. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `session.py`

### 13.1. –ù–æ–≤–æ–µ –ø–æ–ª–µ

```python
@dataclass
class Session:
    ...
    manager_enabled: bool = False
```

### 13.2. –í–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ `manager_enabled = True` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å `agent_enabled = False` –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ `bot.py` –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ callback'–∞ `manager_set:on` / `agent_set:on`.

## 14. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `state.py`

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `manager_enabled` –≤ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å–µ—Å—Å–∏–∏ (–≤ `save_sessions` / `load_sessions`).

## 15. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (`/interrupt`)

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç `/interrupt` –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã manager'–∞:

1. –ï—Å–ª–∏ manager –Ω–∞ —ç—Ç–∞–ø–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (CLI —Ä–∞–±–æ—Ç–∞–µ—Ç) ‚Üí –ø—Ä–µ—Ä—ã–≤–∞—Ç—å CLI (`session.interrupt()`).
2. –ï—Å–ª–∏ manager –Ω–∞ —ç—Ç–∞–ø–µ —Ä–µ–≤—å—é (Agent —Ä–∞–±–æ—Ç–∞–µ—Ç) ‚Üí –æ—Ç–º–µ–Ω—è—Ç—å task Executor'–∞.
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–∞–Ω–∞. –¢–µ–∫—É—â–∞—è –∑–∞–¥–∞—á–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (`in_progress` –∏–ª–∏ `in_review`).
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: ¬´–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –ó–∞–¥–∞—á–∞ "{title}" –æ—Å—Ç–∞–ª–∞—Å—å –≤ —Å—Ç–∞—Ç—É—Å–µ {status}.¬ª

**–í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è:**
–ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `_next_ready_task()` –æ–±–Ω–∞—Ä—É–∂–∏—Ç –∑–∞–¥–∞—á—É –≤ —Å—Ç–∞—Ç—É—Å–µ `in_progress`/`in_review`, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –µ—ë –≤ `pending` (–±–µ–∑ —Å–±—Ä–æ—Å–∞ `attempt`) –∏ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–Ω–æ–≤–æ. CLI —É–≤–∏–¥–∏—Ç —á–∞—Å—Ç–∏—á–Ω–æ —Å–¥–µ–ª–∞–Ω–Ω—É—é —Ä–∞–±–æ—Ç—É, —Ç–∞–∫ –∫–∞–∫ —Ñ–∞–π–ª—ã —É–∂–µ –Ω–∞ –¥–∏—Å–∫–µ. –ù–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏ –ù–ï —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ—Å–ª–µ interrupt ‚Äî —ç—Ç–æ –Ω–µ rejection, –∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ.

## 16. –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ Manager

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤–∫–ª—é—á–∏—Ç—å manager (`manager_set:on`) –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

1. **OpenAI —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω** (`openai_api_key` + `openai_model`). –ë–µ–∑ OpenAI –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ —Ñ–∞–∑–∞ 2 –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏, —Ä–µ–≤—å—é, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è.
   - –ï—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–î–ª—è —Ä–∞–±–æ—Ç—ã Manager –Ω—É–∂–µ–Ω OpenAI API. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ openai_api_key –∏ openai_model –≤ config.yaml.¬ª
2. **–ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è CLI-—Å–µ—Å—Å–∏—è.** Manager –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –≤ CLI.
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ: ¬´–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Å–µ—Å—Å–∏—é —á–µ—Ä–µ–∑ /new.¬ª

–≠—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî –≤ `cmd_manager` / callback `manager_set:on`.

## 17. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏

### 17.1. CLI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

–ï—Å–ª–∏ `session.run_prompt()` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ (CLI –Ω–µ –∑–∞–ø—É—â–µ–Ω, —É–ø–∞–ª):
- –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å CLI.
- –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ ‚Üí –ø–æ–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É `failed`, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–µ (–µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç failed).

### 17.2. OpenAI API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

–ï—Å–ª–∏ LLM-–≤—ã–∑–æ–≤—ã –¥–ª—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏/—Ä–µ–≤—å—é/—Ä–µ—à–µ–Ω–∏–π –ø–∞–¥–∞—é—Ç:
- –†–µ–≤—å—é –±–µ–∑ LLM –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ ‚Üí –ø–æ–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É `failed`.
- –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –±–µ–∑ LLM ‚Üí —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω –∏–∑ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏ (fallback, –≤–µ—Å—å —Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞).

### 17.3. –ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ

- `max_attempts` –Ω–∞ –∑–∞–¥–∞—á—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3) ‚Üí –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π dev-review —Ü–∏–∫–ª.
- –û–±—â–∏–π –ª–∏–º–∏—Ç –∏—Ç–µ—Ä–∞—Ü–∏–π –Ω–∞ –≤–µ—Å—å –ø–ª–∞–Ω: `manager_max_tasks * max_attempts` ‚Üí –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç.

### 17.4. –ü—É—Å—Ç–æ–π –≤—ã–≤–æ–¥ CLI

–ï—Å–ª–∏ CLI –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π –æ—Ç–≤–µ—Ç:
- –°—á–∏—Ç–∞—Ç—å –ø–æ–ø—ã—Ç–∫—É –Ω–µ—É—Å–ø–µ—à–Ω–æ–π.
- –í –ø—Ä–æ–º–ø—Ç–µ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏ —É–∫–∞–∑–∞—Ç—å: ¬´–ü—Ä–µ–¥—ã–¥—É—â–∞—è –ø–æ–ø—ã—Ç–∫–∞ –Ω–µ –¥–∞–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞¬ª.

### 17.5. –ö–∞—Å–∫–∞–¥–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

–ï—Å–ª–∏ `_next_ready_task()` –≤–µ—Ä–Ω—É–ª `None`, –Ω–æ –æ—Å—Ç–∞–ª–∏—Å—å –∑–∞–¥–∞—á–∏ –Ω–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ:
- –í—Å–µ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç `failed` ‚Üí –ø–æ–º–µ—Ç–∏—Ç—å –∏—Ö `blocked`.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `plan.status = "failed"`.
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç—á—ë—Ç —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º: –∫–∞–∫–∞—è –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å –∏ –∫–∞–∫–∏–µ –±—ã–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∏–∑-–∑–∞ –Ω–µ—ë.

### 17.6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π flow: –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å ¬´–û—á–µ—Ä–µ–¥—å / –û—Ç–º–µ–Ω–∞ / –ü—Ä–µ—Ä–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é¬ª. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ Agent-—Ä–µ–∂–∏–º—É.

## 18. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 17.1. Unit-—Ç–µ—Å—Ç—ã

| –§–∞–π–ª | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç |
|------|-------------|
| `tests/test_manager_decompose.py` | –ü–∞—Ä—Å–∏–Ω–≥ –ø–ª–∞–Ω–∞ –∏–∑ JSON, fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö |
| `tests/test_manager_next_task.py` | –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–¥–∞—á–∏ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ |
| `tests/test_manager_review_parse.py` | –ü–∞—Ä—Å–∏–Ω–≥ –≤–µ—Ä–¥–∏–∫—Ç–∞ —Ä–µ–≤—å—é–µ—Ä–∞ –∏–∑ —Ç–µ–∫—Å—Ç–∞ |
| `tests/test_manager_store.py` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ `MANAGER_PLAN.json` |
| `tests/test_manager_cycle.py` | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: decompose ‚Üí develop ‚Üí review ‚Üí decision (—Å –º–æ–∫–∞–º–∏) |

### 17.2. –ß—Ç–æ –º–æ–∫–∞—Ç—å

- `session.run_prompt()` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç ¬´–°–æ–∑–¥–∞–ª —Ñ–∞–π–ª—ã X, Y, Z¬ª.
- `chat_completion()` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON-–æ—Ç–≤–µ—Ç (–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è, —Ä–µ—à–µ–Ω–∏–µ).
- `Executor.run()` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `ExecutorResponse` —Å –≤–µ—Ä–¥–∏–∫—Ç–æ–º.

## 19. –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
1. –î–æ–±–∞–≤–∏—Ç—å `DevTask`, `ProjectPlan`, `ReviewResult` –≤ `agent/contracts.py`.
2. –°–æ–∑–¥–∞—Ç—å `agent/manager_store.py` (save/load/delete plan).
3. –î–æ–±–∞–≤–∏—Ç—å `manager_enabled` –≤ `Session`, `state.py`.
4. –î–æ–±–∞–≤–∏—Ç—å `manager_*` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `config.py` –∏ `config_example.yaml`.

### –§–∞–∑–∞ 2: –ü—Ä–æ–º–ø—Ç—ã –∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è
5. –°–æ–∑–¥–∞—Ç—å `agent/manager_prompts.py` —Å —à–∞–±–ª–æ–Ω–∞–º–∏ –ø—Ä–æ–º–ø—Ç–æ–≤.
6. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_decompose()` –≤ `agent/manager.py`.
7. –¢–µ—Å—Ç—ã: `test_manager_decompose.py`.

### –§–∞–∑–∞ 3: –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ü–∏–∫–ª
8. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_delegate_develop()` (–≤—ã–∑–æ–≤ CLI).
9. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_delegate_review()` (–≤—ã–∑–æ–≤ Executor —Å reviewer-–ø—Ä–æ—Ñ–∏–ª–µ–º).
10. –î–æ–±–∞–≤–∏—Ç—å `build_reviewer_profile()` –≤ `agent/profiles.py`.
11. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª `run()` –≤ `ManagerOrchestrator`.
12. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_next_ready_task()`, `_make_decision()`, `_compose_final_report()`.
13. –¢–µ—Å—Ç—ã: `test_manager_next_task.py`, `test_manager_cycle.py`.

### –§–∞–∑–∞ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º
14. –î–æ–±–∞–≤–∏—Ç—å `/manager` –∫–æ–º–∞–Ω–¥—É –≤ `command_registry.py`.
15. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `cmd_manager` + callback'–∏ –≤ `bot.py`.
16. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_handle_manager_input`, `run_manager`, `_start_manager_task`.
17. –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –≤ `_handle_user_input`.
18. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ –æ—á–µ—Ä–µ–¥–∏.
19. –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: `manager_enabled` –≤ `state.json`.

### –§–∞–∑–∞ 5: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –æ—Ç—á—ë—Ç
20. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_notify_progress()` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤ Telegram.
21. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `_compose_final_report()` —Å –∫—Ä–∞—Å–∏–≤—ã–º Markdown.
22. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.

## 20. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è v1

- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è** –≤ v1 (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ).
- –†–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –Ω–∞ –ª–µ—Ç—É) **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è** –≤ v1.
- Manager –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ CLI-—Å–µ—Å—Å–∏–∏; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â—É—é.
- –†–µ–≤—å—é –¥–µ–ª–∞–µ—Ç—Å—è Agent'–æ–º (OpenAI), –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º CLI.

## 21. –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è v2

- **–†–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ø–æ—Å–ª–µ N –∑–∞–¥–∞—á Manager –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –ø–ª–∞–Ω —Å —É—á—ë—Ç–æ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏:** –µ—Å–ª–∏ –∑–∞–¥–∞—á–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, –∑–∞–ø—É—Å–∫–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –≤ —Ä–∞–∑–Ω—ã—Ö CLI-—Å–µ—Å—Å–∏—è—Ö.
- **–†–µ–≤—å—é —á–µ—Ä–µ–∑ –≤—Ç–æ—Ä–æ–π CLI:** —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–µ—Å—Å–∏—é —Å –¥—Ä—É–≥–∏–º CLI –¥–ª—è —Ä–µ–≤—å—é (Claude —Ä–µ–≤—å—é–∏—Ç –∫–æ–¥, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π Codex).
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–Ω (—É–¥–∞–ª–∏—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á–∏) –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
- **–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ:** –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–≤—å—é–µ—Ä–æ–≤ (—Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏) –≥–æ–ª–æ—Å—É—é—Ç –∑–∞ approved/rejected.
