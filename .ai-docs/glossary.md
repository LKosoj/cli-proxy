# Глоссарий

## Агент (Agent)
Режим работы бота, реализующий архитектуру ReAct (Reasoning + Acting). Агент использует LLM для анализа задачи, вызова инструментов и генерации ответов. Управляет памятью, историей диалога и выполняет команды в изолированной среде. Активируется командой `/agent`.

## Активная сессия
Сессия, с которой в данный момент работает пользователь. Информация об активной сессии хранится в `ActiveState` и используется для определения контекста выполнения команд. Управляется через `SessionManager`.

## Активное состояние (ActiveState)
Дата-класс, хранящий информацию об активной сессии: идентификатор, инструмент, рабочая директория и временная метка обновления. Сохраняется в `state.json`.

## Анонимизация
Процесс удаления или замены чувствительных данных (например, API-ключей, путей) в выводе команд для предотвращения утечки информации. Реализована в `helpers.sanitize_output`.

## Арбитраж
Процесс принятия решения о соответствии реализации задачи критериям приёма. В режиме Manager используется LLM-арбитр (`_make_decision`) для объективной оценки результатов разработки и ревью.

## Асинхронное выполнение
Метод выполнения операций без блокировки основного потока. Используется для обработки команд, взаимодействия с API и выполнения длительных задач. Реализовано через `asyncio`.

## Аутентификация
Проверка подлинности пользователя. В системе реализована через `whitelist_chat_ids` в конфигурации Telegram и токены для доступа к внешним сервисам (GitHub, MCP).

## Авто-коммит
Автоматическое создание коммита в Git после успешного выполнения задачи в режиме Manager. Активируется опцией `manager_auto_commit` в конфигурации.

## Авто-возобновление
Возможность автоматического возобновления выполнения плана после перезапуска бота. Управляется флагом `manager_auto_resume` в конфигурации.

## Блокировка команд
Механизм предотвращения выполнения потенциально опасных команд (например, `rm -rf`, `sudo`). Реализован в `helpers.check_command` и `BLOCKED_PATTERNS_PATH`.

## Восстановление состояния
Процесс загрузки сохранённого состояния сессий, активной сессии и плана Manager после перезапуска бота. Использует файлы `state.json`, `toolhelp.json` и `MANAGER_PLAN.json`.

## Временная метка (timestamp)
Дата и время последнего обновления сессии или записи. Используется для отображения актуальности данных и сортировки. Форматируется через `format_ts`.

## Входной контекст (request_context)
Дополнительная информация, передаваемая в промпт агента для уточнения задачи. Включает ограничения, цели и специфические требования.

## Выполнение команды
Процесс запуска shell-команды в рабочей директории сессии. Реализовано через `pexpect` (интерактивный режим) или `asyncio.subprocess` (headless-режим). Управляет вводом/выводом и обрабатывает таймауты.

## Генерация промпта
Процесс создания системного промпта для LLM на основе шаблона, подстановки переменных (например, `{{cwd}}`, `{{tools}}`) и контекста. Используется в `ReActAgent._build_messages`.

## Декомпозиция задачи
Процесс разбиения сложной задачи пользователя на атомарные подзадачи. В режиме Manager выполняется через CLI-анализ проекта и нормализацию вывода в JSON. Управляется таймаутом `manager_decompose_timeout_sec`.

## Диспетчер (Dispatcher)
Компонент, отвечающий за выбор профиля исполнителя (`ExecutorProfile`) для каждого шага плана. На текущий момент поддерживает только один профиль по умолчанию.

## Зависимости задач
Связи между задачами, определяющие порядок их выполнения. Задача может зависеть от успешного завершения одной или нескольких других задач. Управляется через `depends_on` в `DevTask`.

## Задача (DevTask)
Единица работы в режиме Manager. Содержит описание, критерии приёма, статус, зависимости и историю выполнения. Является частью `ProjectPlan`.

## Запрос на подтверждение
Механизм запроса у пользователя подтверждения перед выполнением потенциально опасной команды. Реализован через `PendingCommand` и `set_approval_callback`.

## Зона безопасности (sandbox)
Изолированная рабочая среда для выполнения команд. Ограничивает доступ к файловой системе и предотвращает выполнение вредоносных операций. Корень задаётся через `AGENT_SANDBOX_ROOT`.

## Инструмент (tool)
Внешняя CLI-команда или скрипт, доступный для вызова агентом. Определяется в конфигурации (`tools.*`) с указанием команды, режима выполнения, переменных окружения и регулярных выражений для определения состояний.

## Интерактивный режим
Режим выполнения сессии, при котором бот ожидает приглашения ввода (prompt) и может возобновить сессию по токену. Использует `pexpect` для управления процессом.

## Кэширование
Хранение результатов операций для ускорения последующих запросов. Используется для кэширования справки инструментов (`toolhelp.json`) и клиентов OpenAI.

## Критерии приёма
Условия, которым должна соответствовать реализация задачи для её успешного завершения. Определяются при декомпозиции задачи и используются при ревью.

## Логирование
Процесс записи событий работы системы в файлы. Поддерживает разделение по уровням (INFO, ERROR) и источникам (агент, основной поток). Использует `TimedRotatingFileHandler` с ротацией в полночь.

## Менеджер (Manager)
Режим автономной оркестрации мульти-агентной разработки. Автоматически декомпозирует задачу, выполняет подзадачи, проводит ревью и генерирует итоговый отчёт. Активируется командой `/manager`.

## Метаданные сессии
Дополнительная информация о сессии: git-состояние, временные метки, данные агента. Хранится в `SessionState` и используется для отображения статуса.

## Миграция состояния
Процесс преобразования данных из устаревшего формата хранения в новый. Реализован в `state.py` для поддержки совместимости с предыдущими версиями.

## Многопользовательские сессии
Поддержка одновременной работы нескольких пользователей с изолированными контекстами выполнения. Каждая сессия имеет уникальный идентификатор и рабочую директорию.

## Модель (model)
LLM, используемая для генерации ответов. Определяется в конфигурации (`openai_model`, `openai_big_model`) и может быть переопределена переменными окружения.

## Нормализация
Процесс приведения неструктурированного вывода к валидному JSON-формату. Используется при декомпозиции задачи и парсинге ревью. Реализовано через `DECOMPOSE_NORMALIZE_SYSTEM`.

## Очередь команд
Механизм управления параллельными задачами в сессии. Предотвращает конфликты и обеспечивает последовательное выполнение команд. Управляется через `Session.run_lock`.

## Очередь задач
Список команд, ожидающих выполнения в сессии. Отображается через `/queue` и может быть очищена через `/clearqueue`.

## Пагинация
Разделение длинных списков (например, директорий, задач) на страницы для удобного отображения в интерфейсе. Используется в `build_dirs_keyboard` и `build_tasks_menu`.

## План проекта (ProjectPlan)
Структурированный план разработки, содержащий список задач, анализ состояния и общий статус. Хранится в `MANAGER_PLAN.json` и используется в режиме Manager.

## Подсистема (subsystem)
Логическая часть системы, отвечающая за определённую функциональность (например, `GitOps`, `SessionUI`). Обеспечивает модульность и изолированность кода.

## Повторные попытки
Механизм повторного выполнения операций при временных сбоях (например, сетевые ошибки). Используется в `TelegramIO.send_message` с экспоненциальной задержкой.

## Пользовательский интерфейс (UI)
Интерактивный интерфейс для управления сессиями и инструментами через Telegram. Реализован через inline-кнопки и callback-обработчики.

## Путь к файлу
Абсолютный или относительный путь в файловой системе. Проверяется на безопасность через `is_within_root` для предотвращения path traversal.

## Ревью
Процесс проверки реализации задачи на соответствие критериям приёма. В режиме Manager выполняется агентом-ревьюером с использованием LLM. Результат хранится в `ReviewResult`.

## Режим headless
Режим выполнения сессии без интерактивного ввода. Команды запускаются напрямую через `asyncio.subprocess`, вывод обрабатывается асинхронно.

## Режим ожидания ввода
Состояние, при котором бот ожидает текстовое сообщение от пользователя для выполнения действия (например, переименование сессии). Управляется через `pending_session_rename`.

## Резервное копирование
Создание резервной копии важных файлов (например, `state.json`) при ротации логов. Обеспечивает сохранность данных при сбоях.

## Ротация логов
Периодическое переименование и создание новых файлов логов. Использует `TimedRotatingFileHandler` с ротацией в полночь по UTC.

## Сессия
Изолированный контекст выполнения команд с уникальным идентификатором, инструментом и рабочей директорией. Управляется через `SessionManager`.

## Сессионный интерфейс (SessionUI)
Класс, обеспечивающий пользовательский интерфейс для управления сессиями через Telegram. Формирует меню, обрабатывает callback-действия и ввод пользователя.

## Состояние сессии (SessionState)
Дата-класс, описывающий состояние сессии: идентификатор, инструмент, рабочая директория, токен возобновления, краткое описание, имя и временная метка обновления.

## Статус сессии
Информация о текущем состоянии сессии: занятость, время работы, очередь команд, git-состояние. Отображается через `/status` и `sess_status`.

## Статический анализ
Проверка кода на наличие потенциально опасных конструкций без его выполнения. Используется в `CodeInterpreterTool._static_block` для блокировки импортов и системных вызовов.

## Структурированный вывод
Формат вывода, при котором данные возвращаются в виде JSON-объекта с полями `success`, `output`/`error`. Используется в инструментах для совместимости с агентом.

## Таймаут
Максимальное время ожидания выполнения операции. Используется для предотвращения зависаний (например, `idle_timeout_sec`, `manager_dev_timeout_sec`).

## Текущая рабочая директория (cwd)
Директория, в которой выполняются команды сессии. Отображается через `/cwd` и может быть изменена через `/newpath`.

## Токен возобновления (resume token)
Уникальный идентификатор сессии, позволяющий возобновить её после перезапуска. Извлекается из вывода команды по регулярному выражению (`resume_regex`).

## Управление памятью
Механизм хранения и сжатия контекстной информации (например, `MEMORY.md`). Используется для сохранения важных данных между сессиями и ограничения объёма памяти.

## Фильтрация команд
Проверка команд на соответствие политике безопасности. Блокирует выполнение команд, содержащих опасные паттерны (например, `env`, `sudo`). Реализовано в `BLOCKED_PATTERNS_PATH`.

## Форматирование вывода
Преобразование вывода команды в удобочитаемый вид. Включает удаление ANSI-кодов, преобразование в HTML, рендеринг Mermaid-диаграмм.

## Хранение состояния
Сохранение данных о сессиях, активной сессии и плане Manager в JSON-файлах (`state.json`, `MANAGER_PLAN.json`) для восстановления после перезапуска.

## Целостность данных
Гарантия сохранения данных при одновременном доступе из нескольких процессов. Обеспечивается через `read_json_locked` и `write_json_locked` с системными блокировками.

## Шаблон задачи (preset)
Готовый сценарий выполнения команд, доступный через скрытую команду `/preset`. Используется для запуска типовых операций (например, тесты, линтер).

## Эмодзи-статус
Отображение статуса задачи или сессии с помощью эмодзи (например, ✅, ❌, ⏳). Используется в `format_manager_status` для визуального восприятия.
