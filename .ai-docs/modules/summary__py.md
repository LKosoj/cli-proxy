# summary

Модуль предоставляет функциональность для автоматического резюмирования текста и генерации сообщений коммитов с использованием API OpenAI. Поддерживает настройку через переменные окружения и конфигурационный объект, обработку ошибок, предварительную очистку входных данных и форматирование ключевой информации. Основной язык вывода — русский.

Ключевые структуры данных  
AppConfig — конфигурационный объект приложения, содержащий настройки по умолчанию, включая параметры OpenAI

---
summarize_text(text: str, max_chars: int = 3000, config: Optional[AppConfig] = None) -> Optional[str]  
Генерирует краткое резюме текста на русском языке с ограничением по длине.  
Аргументы  
text — входной текст для резюмирования  
max_chars — максимальное количество символов в итоговом резюме (по умолчанию 3000)  
config — опциональный объект конфигурации приложения для получения настроек OpenAI  
Возвращает  
Резюме текста или None, если не удалось настроить подключение к OpenAI  
Исключения  
Не выбрасывает исключения

---
summarize_text_with_reason(text: str, max_chars: int = 3000, config: Optional[AppConfig] = None) -> Tuple[Optional[str], Optional[str]]  
Генерирует резюме и возвращает его вместе с причиной ошибки (если возникла).  
Аргументы  
text — входной текст для резюмирования  
max_chars — максимальное количество символов в итоговом резюме (по умолчанию 3000)  
config — опциональный объект конфигурации приложения для получения настроек OpenAI  
Возвращает  
Кортеж из резюме (или None) и строки с описанием ошибки (или None, если ошибки нет)  
Исключения  
Не выбрасывает исключения

---
_get_openai_config(config: Optional[AppConfig] = None) -> Optional[Tuple[str, str, str]]  
Извлекает и объединяет настройки OpenAI из переменных окружения и конфигурации.  
Аргументы  
config — опциональный объект конфигурации приложения  
Возвращает  
Кортеж из (api_key, model, base_url) или None, если обязательные параметры отсутствуют  
Исключения  
Не выбрасывает исключения

---
_strip_cli_preamble(text: str) -> str  
Удаляет служебный заголовок (например, метаданные CLI-интерфейса) из начала текста, если он присутствует.  
Аргументы  
text — входной текст, из которого нужно удалить преамбулу  
Возвращает  
Очищенный текст без заголовка, если он распознан; иначе — исходный текст  
Исключения  
Не выбрасывает исключения

---
_length_bucket(text_len: int) -> str  
Определяет категорию длины текста: "короткий", "средний" или "длинный".  
Аргументы  
text_len — длина текста в символах  
Возвращает  
Строку, описывающую категорию длины текста  
Исключения  
Не выбрасывает исключения

---
_suggest_max_tokens(text: str, max_chars: int) -> int  
Оценивает оптимальное значение max_tokens для генерации в зависимости от длины текста и лимита символов.  
Аргументы  
text — входной текст  
max_chars — максимальное количество символов в выводе  
Возвращает  
Рекомендуемое количество токенов для генерации (в пределах 200–1200)  
Исключения  
Не выбрасывает исключения

---
_compact_reason(reason: str) -> str  
Сжимает текст причины до 120 символов с многоточием, если он слишком длинный.  
Аргументы  
reason — текст причины или ошибки  
Возвращает  
Сжатая версия текста длиной не более 120 символов  
Исключения  
Не выбрасывает исключения

---
_summarize_with_cfg(text: str, max_chars: int, cfg: Tuple[str, str, str]) -> str  
Генерирует резюме с использованием заданной конфигурации OpenAI.  
Аргументы  
text — текст для резюмирования  
max_chars — максимальное количество символов в итоговом резюме  
cfg — кортеж из (api_key, model, base_url) для вызова OpenAI API  
Возвращает  
Сгенерированное резюме, обрезанное до max_chars при необходимости  
Исключения  
Выбрасывает исключения requests при ошибках HTTP, таймаутах или проблемах сети

---
_tail_digest(text: str) -> str  
Извлекает и форматирует ключевые строки из конца текста: результаты или вопросы.  
Аргументы  
text — входной текст  
Возвращает  
Строка с ключевыми пунктами из конца текста (результаты или вопросы), отформатированная как маркированный список  
Исключения  
Не выбрасывает исключения

---
suggest_commit_message(text: str, config: Optional[AppConfig] = None) -> Optional[str]  
Генерирует краткое сообщение коммита на русском языке, отражающее суть изменений.  
Аргументы  
text — текст изменений (например, diff), на основе которого формируется сообщение  
config — опциональный объект конфигурации приложения; если не передан, используется конфиг по умолчанию  
Возвращает  
Строка с кратким сообщением коммита (до ~80 символов, без точки в конце), или None при ошибке или пустом ответе  
Исключения  
Вызывает исключения, связанные с HTTP-запросом (например, requests.RequestException)

---
suggest_commit_message_detailed(text: str, config: Optional[AppConfig] = None) -> Optional[Tuple[str, str]]  
Генерирует детальное сообщение коммита, состоящее из заголовка и тела с пунктовым описанием изменений.  
Аргументы  
text — текст изменений (например, diff), на основе которого формируется сообщение  
config — опциональный объект конфигурации приложения; если не передан, используется конфиг по умолчанию  
Возвращает  
Кортеж из двух строк: (заголовок, тело сообщения), или None при ошибке или некорректном ответе  
Исключения  
Вызывает исключения, связанные с HTTP-запросом (например, requests.RequestException)
