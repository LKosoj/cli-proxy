# agent/mcp/http_client

```markdown
HTTP-клиент для асинхронного взаимодействия с MCP (Model Control Protocol) по протоколу JSON-RPC 2.0.  
Поддерживает инициализацию сессии, вызов инструментов и получение списка доступных инструментов.  
Клиент использует библиотеку `httpx` для выполнения HTTP-запросов.  
Конфигурация задаётся через объект `HttpMCPClientConfig`.

Ключевые структуры данных  
HttpMCPClientConfig — Конфигурация HTTP-клиента MCP, включая URL, таймаут, заголовки и версию протокола.

---
@dataclass
HttpMCPClientConfig
Конфигурация HTTP-клиента MCP.
Поля
name — Имя клиента, используется для логирования и идентификации.
url — Базовый URL MCP-сервера.
timeout_ms — Таймаут запроса в миллисекундах (по умолчанию 30 000).
headers — Дополнительные HTTP-заголовки (опционально).
protocol_version — Версия протокола MCP (по умолчанию "2024-11-05").

---
class HttpMCPClient
Асинхронный HTTP-клиент для взаимодействия с MCP-сервером по протоколу JSON-RPC 2.0.
Поля
cfg — Конфигурация клиента.
_client — Асинхронный HTTP-клиент httpx (инициализируется при старте).
_next_id — Счётчик идентификаторов запросов.
Методы
__init__(cfg: HttpMCPClientConfig) — Создаёт экземпляр клиента с указанной конфигурацией.
start() — Асинхронно инициализирует HTTP-клиент и выполняет handshake с сервером.
stop() — Асинхронно закрывает HTTP-клиент.
list_tools() -> List[MCPToolInfo] — Возвращает список доступных инструментов от MCP-сервера.
call_tool(tool_name: str, arguments: Dict[str, Any]) -> Dict[str, Any] — Вызывает указанный инструмент с аргументами.
_initialize() — Выполняет инициализацию сессии с MCP-сервером.
_notify(method: str, params: Dict[str, Any]) — Отправляет уведомление (без ожидания ответа).
_request(method: str, params: Dict[str, Any], *, notification: bool = False) -> Optional[Dict[str, Any]] — Отправляет JSON-RPC запрос или уведомление.

---
__init__(self, cfg: HttpMCPClientConfig) -> None
Инициализирует клиент с заданной конфигурацией.
Аргументы
cfg — Конфигурация клиента.

---
async start(self) -> None
Запускает HTTP-клиент и инициализирует соединение с MCP-сервером.
Исключения
Любые исключения при инициализации логируются, но не прерывают выполнение.

---
async stop(self) -> None
Останавливает и закрывает HTTP-клиент.

---
async list_tools(self) -> List[MCPToolInfo]
Возвращает список доступных MCP-инструментов с их описанием и схемой входных данных.
Возвращает
Список объектов `MCPToolInfo`, представляющих инструменты.

---
async call_tool(self, tool_name: str, arguments: Dict[str, Any]) -> Dict[str, Any]
Вызывает MCP-инструмент по имени с заданными аргументами.
Аргументы
tool_name — Имя вызываемого инструмента.
arguments — Аргументы вызова в виде словаря.
Возвращает
Результат выполнения инструмента в виде словаря или пустого словаря при ошибке.

---
async _initialize(self) -> None
Выполняет инициализацию сессии с MCP-сервером, отправляя `initialize` и `initialized`.
Исключения
Любые ошибки инициализации логируются, но не прерывают выполнение.

---
async _notify(self, method: str, params: Dict[str, Any]) -> None
Отправляет уведомление на сервер без ожидания ответа.
Аргументы
method — Имя метода уведомления.
params — Параметры уведомления.

---
async _request(self, method: str, params: Dict[str, Any], *, notification: bool = False) -> Optional[Dict[str, Any]]
Отправляет JSON-RPC 2.0 запрос или уведомление на сервер.
Аргументы
method — Имя метода RPC.
params — Параметры вызова.
notification — Если True, запрос считается уведомлением (без id и ожидания ответа).
Возвращает
Результат ответа (если запрос) или None (если уведомление).
Исключения
RuntimeError — При отсутствии запущенного клиента или ошибке в ответе сервера.
```
