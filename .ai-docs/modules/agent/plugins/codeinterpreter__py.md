# agent/plugins/codeinterpreter

Модуль предоставляет инструмент выполнения ограниченного Python-кода в изолированной среде без доступа к системным ресурсам. Код анализируется статически на наличие опасных конструкций, затем запускается в отдельном процессе с ограниченным окружением. Инструмент предназначен для безопасного выполнения вычислений, анализа данных и простых скриптов без риска выполнения произвольного кода.

Ключевые структуры данных  
CodeInterpreterTool — Реализация плагина инструмента для выполнения ограниченного Python-кода

---
class CodeInterpreterTool  
Плагин инструмента для безопасного выполнения Python-кода в изолированной среде  
Методы  
def get_source_name() -> str — Возвращает имя источника инструмента  
def get_spec() -> ToolSpec — Возвращает спецификацию инструмента, включая параметры и ограничения  
async def execute(args: Dict[str, Any], ctx: Dict[str, Any]) -> Dict[str, Any] — Асинхронно выполняет переданный Python-код с ограничениями  
def _static_block(code: str) -> tuple[bool, str] — Проверяет код на наличие запрещённых конструкций с помощью регулярных выражений  
def _run_sync(code: str, timeout: int) -> str — Синхронно запускает код в отдельном процессе Python

---
def _static_block(code: str) -> tuple[bool, str]  
Проверяет код на наличие потенциально опасных конструкций с помощью регулярных выражений  
Аргументы  
code — Входной Python-код для анализа  
Возвращает  
Кортеж из булева флага (заблокировано ли) и причины блокировки  
Исключения  
Не выбрасывает исключения; ошибки регулярных выражений логируются и игнорируются

---
def _run_sync(code: str, timeout: int) -> str  
Запускает Python-код в отдельном процессе с ограниченным окружением  
Аргументы  
code — Python-код для выполнения  
timeout — Максимальное время выполнения в секундах (ограничено от 1 до 60)  
Возвращает  
Стандартный вывод и ошибки выполнения, объединённые в строку  
Исключения  
subprocess.TimeoutExpired — Если выполнение превысило заданный таймаут  
subprocess.CalledProcessError — Не обрабатывается напрямую, результат проверяется по returncode

---
async def execute(args: Dict[str, Any], ctx: Dict[str, Any]) -> Dict[str, Any]  
Асинхронно выполняет ограниченный Python-код, проверяя его перед запуском  
Аргументы  
args — Аргументы выполнения, включая `code` и опционально `timeout_sec`  
ctx — Контекст выполнения (не используется напрямую)  
Возвращает  
Словарь с результатом выполнения: `success`, `output` или `error`  
Исключения  
Любое исключение преобразуется в словарь с `success=False` и описанием ошибки
