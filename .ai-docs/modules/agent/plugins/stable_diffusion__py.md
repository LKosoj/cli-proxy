# agent/plugins/stable_diffusion

Модуль реализует инструмент генерации изображений по текстовому описанию с использованием Stable Diffusion через HuggingFace Inference API. Инструмент интегрируется в систему плагинов, предоставляя асинхронный интерфейс выполнения с поддержкой таймаутов и параллельного исполнения. Результатом работы является временный файл в формате PNG, путь к которому возвращается после успешной генерации.

Ключевые структуры данных  
StableDiffusionTool — Плагин, реализующий генерацию изображений через HuggingFace API

---
async def execute(self, args: Dict[str, Any], ctx: Dict[str, Any]) -> Dict[str, Any]  
Асинхронно запускает генерацию изображения по промпту и возвращает путь к сохранённому файлу.  
Аргументы  
args — Аргументы инструмента: prompt (обязательный), model (опциональный)  
ctx — Контекст выполнения (не используется)  
Возвращает  
Словарь с ключами "success", "output" (при успехе) или "error" (при ошибке)  
Исключения  
Любые исключения перехватываются и преобразуются в словарь с ошибкой

---
def _generate_sync(self, token: str, model: str, prompt: str) -> str  
Синхронная генерация изображения через HuggingFace Inference API.  
Аргументы  
token — Токен авторизации для доступа к API  
model — Идентификатор модели в репозитории HuggingFace  
prompt — Текстовый промпт для генерации изображения  
Возвращает  
Путь к временному файлу PNG с результатом генерации  
Исключения  
RuntimeError — При ошибке HTTP-запроса или недоступности модели

---
class StableDiffusionTool  
Плагин для генерации изображений с помощью модели Stable Diffusion через HuggingFace Inference API.  
Методы  
get_source_name() -> str — Возвращает источник инструмента: "HuggingFace Inference"  
get_spec() -> ToolSpec — Возвращает спецификацию инструмента, включая параметры и таймаут  
execute(args: Dict[str, Any], ctx: Dict[str, Any]) -> Dict[str, Any] — Асинхронно выполняет генерацию изображения  
_generate_sync(token: str, model: str, prompt: str) -> str — Синхронно вызывает API и сохраняет результат в файл
