# agent/plugins/haiper_image_to_video

Модуль предоставляет инструмент для генерации видео на основе изображения и текстового описания с использованием внешнего API (api.vsegpt.ru). Основная логика включает чтение изображения, отправку запроса на анимацию, ожидание результата и сохранение сгенерированного видео во временной директории. Работа с API осуществляется синхронно в отдельном потоке, чтобы не блокировать асинхронный цикл.

Ключевые структуры данных  
Dict — Словарь с результатом выполнения: успех, ошибка или путь к видео

---
async def generate_video(args: Dict[str, Any], ctx: Dict[str, Any]) -> Dict[str, Any]  
Асинхронно запускает процесс генерации видео на основе изображения и промпта.  
Аргументы  
args — Словарь с параметрами: image_path (обязательный), prompt (опционально), model (опционально, по умолчанию haiper-2.0)  
ctx — Контекст выполнения, содержит cwd для разрешения относительных путей  
Возвращает  
Словарь с результатом: {"success": True, "output": "путь_к_видео"} или {"success": False, "error": "описание"}  
Исключения  
Любые исключения перехватываются и возвращаются как ошибка в словаре

---
def _run_sync(self, token: str, image_path: str, prompt: str, model_id: str) -> str  
Синхронно отправляет запрос на генерацию видео и ожидает его завершения.  
Аргументы  
token — API-токен для авторизации  
image_path — Путь к изображению на диске  
prompt — Текстовый промпт для анимации  
model_id — Идентификатор модели (например, haiper-2.0)  
Возвращает  
Путь к загруженному локально видео-файлу  
Исключения  
RuntimeError — При ошибках HTTP, отсутствии данных или таймауте задачи

---
def _download_video(self, url: str) -> str  
Скачивает видео по указанному URL и сохраняет во временной директории.  
Аргументы  
url — Прямая ссылка на видео-файл  
Возвращает  
Локальный путь к сохранённому видеофайлу  
Исключения  
RuntimeError — Если загрузка не удалась (ошибка HTTP или сетевая ошибка)

---
class HaiperImageToVideoTool  
Инструмент для конвертации изображения в видео с использованием Haiper через API vsegpt.ru. Поддерживает диалоговый интерфейс в Telegram.  
Поля  
API_URL — Базовый URL API для генерации видео  
DIALOG_TIMEOUT — Таймаут диалога в секундах (по умолчанию 3600)  
Методы  
get_source_name — Возвращает имя источника инструмента  
get_spec — Возвращает спецификацию инструмента в формате ToolSpec  
get_menu_label — Возвращает метку инструмента для меню  
get_menu_actions — Возвращает список действий для интерфейса меню  
get_commands — Возвращает команды, поддерживаемые инструментом  
callback_handlers — Возвращает обработчики callback-запросов  
dialog_steps — Возвращает словарь шагов диалога  
step_hint — Возвращает текст подсказки для указанного шага диалога  
extra_message_filters — Возвращает фильтры для дополнительных типов сообщений  
execute — Асинхронно выполняет конвертацию изображения в видео через API
