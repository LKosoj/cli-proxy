# agent/plugins/web_research

```markdown
Плагин для проведения веб-исследований по заданной теме. Генерирует мультиязычные поисковые запросы с помощью OpenAI, выполняет поиск через Jina AI и при необходимости анализирует содержимое найденных страниц. Поддерживает настройку количества результатов и анализ контента для формирования итогового ответа.

Ключевые структуры данных  
LANG_QUERIES_PROMPTS — Словарь с языковыми шаблонами промптов для генерации поисковых запросов на разных языках (русский, английский, китайский).

---
class WebResearchTool  
Плагин инструмента для поиска релевантных статей в интернете по смысловому запросу.  
Поля  
JINA_SEARCH_URL — Базовый URL для поиска через Jina AI.  
JINA_READER_URL — Базовый URL для чтения контента через Jina Reader.  
Методы  
get_source_name() -> str — Возвращает имя источника инструмента.  
get_spec() -> ToolSpec — Возвращает спецификацию инструмента, включая параметры и описание.  
_get_jina_api_key() -> Optional[str] — Получает API-ключ Jina из переменных окружения или конфигурации.  
_get_openai_client() -> AsyncOpenAI — Создаёт асинхронного клиента OpenAI на основе настроек.  
_get_model(big: bool = False) -> str — Возвращает модель OpenAI, используемую для генерации (малая или большая).  
_call_openai_for_queries(user_prompt: str, system_prompt: Optional[str] = None) -> List[str] — Асинхронно генерирует поисковые запросы через OpenAI.  
_jina_search(query: str, max_results: int = 5) -> List[str] — Выполняет поиск через Jina AI и возвращает список URL.  
_jina_read(url: str) -> Optional[str] — Асинхронно извлекает и возвращает текстовое содержимое страницы через Jina Reader.  
_extract_text_from_html(html: str) -> str — Извлекает чистый текст из HTML с помощью BeautifulSoup.  
_analyze_content_with_openai(query: str, content: str) -> str — Асинхронно анализирует содержимое и формирует ответ на основе исходного запроса.  
run(**kwargs) -> Dict[str, Any] — Основной метод выполнения исследования: генерация запросов, поиск, извлечение и анализ контента.

---
_get_jina_api_key()  
Получает Jina AI API ключ из окружения или конфигурации.  
Возвращает  
API-ключ в виде строки или None, если не найден.

---
_get_openai_client()  
Создает и возвращает асинхронного клиента OpenAI.  
Возвращает  
Экземпляр AsyncOpenAI, настроенный по переменным окружения или конфигурации.

---
_get_model(big: bool = False)  
Возвращает имя модели OpenAI, используемой для генерации запросов или анализа.  
Аргументы  
big — Если True, возвращается большая модель (например, gpt-4o), иначе — более легкая (например, gpt-4o-mini).  
Возвращает  
Имя модели в виде строки.

---
_call_openai_for_queries(user_prompt: str, system_prompt: Optional[str] = None)  
Генерирует список поисковых запросов с помощью OpenAI.  
Аргументы  
user_prompt — Промпт пользователя с описанием темы.  
system_prompt — Необязательный системный промпт для задания роли модели.  
Возвращает  
Список строк — сгенерированных поисковых запросов (не более 5).  
Исключения  
Любые исключения, возникающие при вызове OpenAI API, логируются, но не прерывают выполнение.

---
_jina_search(query: str, max_results: int = 5)  
Выполняет поиск через Jina AI Search API и возвращает список найденных URL.  
Аргументы  
query — Поисковый запрос.  
max_results — Максимальное количество возвращаемых результатов (по умолчанию 5).  
Возвращает  
Список URL в виде строк. Возвращает пустой список при ошибках или отсутствии ключа.

---
_jina_read(url: str)  
Извлекает текстовое содержимое веб-страницы через Jina Reader API.  
Аргументы  
url — URL страницы для извлечения контента.  
Возвращает  
Текстовое содержимое страницы или None в случае ошибки.

---
_extract_text_from_html(html: str)  
Извлекает чистый текст из HTML-контента с помощью BeautifulSoup.  
Аргументы  
html — Строка с HTML-разметкой.  
Возвращает  
Очищенный текст без тегов.

---
_analyze_content_with_openai(query: str, content: str)  
Анализирует содержимое страницы и формирует краткий ответ на основе исходного запроса.  
Аргументы  
query — Исходный запрос пользователя.  
content — Текстовое содержимое страницы.  
Возвращает  
Строка с анализом и ответом на запрос.

---
run(**kwargs)  
Выполняет полный цикл веб-исследования: генерация запросов, поиск, извлечение и анализ.  
Аргументы  
query — Тема исследования.  
max_results_per_lang — Максимальное количество результатов на язык (по умолчанию 10).  
analyze_content — Флаг, указывающий, нужно ли анализировать содержимое (по умолчанию True).  
Возвращает  
Словарь с результатами: список источников, итоговый ответ (если анализ включён), статус выполнения.
```
