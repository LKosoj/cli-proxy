# agent/memory_policy

```markdown
Модуль отвечает за управление долговременной памятью проекта: принимает решение о сохранении информации и сжимает память при превышении лимита.  
Использует LLM через OpenAI-совместимый интерфейс для анализа и обработки памяти.  
Работает с категориями: preference, decision, config, agreement, соблюдая приоритеты и формат хранения.

Ключевые структуры данных
AppConfig — Конфигурация приложения, используемая для настройки клиента OpenAI.

---
async def decide_memory_save(config: AppConfig, user_text: str, final_response: str, memory_text: str) -> Optional[Tuple[str, str]]
Принимает решение, нужно ли сохранить информацию в долговременную память, и возвращает тег и содержание записи.
Аргументы
config — Конфигурация приложения для доступа к LLM.
user_text — Текст запроса пользователя.
final_response — Финальный ответ системы.
memory_text — Текущее содержимое памяти.
Возвращает
Кортеж из тега (например, "PREF") и содержания записи, если необходимо сохранить; иначе None.
Исключения
Не выбрасывает исключения явно, обрабатывает ошибки парсинга JSON внутри.

---
async def compress_memory(config: AppConfig, memory_text: str, max_chars: int) -> Optional[str]
Сжимает текст памяти до заданного количества символов, сохраняя важные факты и формат записей.
Аргументы
config — Конфигурация приложения для доступа к LLM.
memory_text — Текущее содержимое памяти.
max_chars — Максимально допустимое количество символов в сжатой памяти.
Возвращает
Сжатое содержимое памяти в виде строки или None, если сжатие не удалось.
Исключения
Не выбрасывает исключения явно.
```
