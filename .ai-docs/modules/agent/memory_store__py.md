# agent/memory_store

Модуль предоставляет инструменты для работы с файлом памяти `MEMORY.md`, расположенным в заданной директории. Он позволяет читать, записывать и дополнять содержимое памяти, а также парсить записи с временной меткой и тегами. Поддерживается фильтрация дубликатов, обрезка по размеру и компактизация записей по приоритету тегов.

Ключевые структуры данных  
Dict[str, str] — Словарь, представляющий одну запись в памяти с ключами 'ts', 'tag', 'text', 'raw'  
List[Dict[str, str]] — Список разобранных записей из содержимого памяти

def read_memory(cwd: str) -> str  
Читает содержимое файла памяти из указанной директории.  
Аргументы  
cwd — Путь к рабочей директории, в которой находится файл MEMORY.md  
Возвращает  
Содержимое файла памяти как строка; пустая строка, если файл не существует

---
def write_memory(cwd: str, content: str) -> None  
Записывает указанное содержимое в файл памяти, перезаписывая его.  
Аргументы  
cwd — Путь к рабочей директории  
content — Новое содержимое для записи в файл памяти

---
def append_memory(cwd: str, content: str) -> None  
Добавляет новую запись с временной меткой в конец файла памяти.  
Аргументы  
cwd — Путь к рабочей директории  
content — Текст записи для добавления (без тега)

---
def memory_size_bytes(content: str) -> int  
Вычисляет размер строки в байтах при кодировании UTF-8.  
Аргументы  
content — Входная строка  
Возвращает  
Размер строки в байтах

---
def trim_for_context(content: str, max_chars: int = 2000) -> str  
Обрезает содержимое до указанного количества символов с пометкой о сокращении.  
Аргументы  
content — Входной текст  
max_chars — Максимальное количество символов (по умолчанию 2000)  
Возвращает  
Обрезанная строка, если превышает лимит, иначе исходная строка

---
def parse_entries(content: str) -> List[Dict[str, str]]  
Разбирает содержимое памяти на список структурированных записей.  
Аргументы  
content — Текст памяти, содержащий строки с записями  
Возвращает  
Список словарей с полями 'ts', 'tag', 'text', 'raw' для каждой валидной записи

---
def append_memory_tagged(cwd: str, tag: str, content: str) -> bool  
Добавляет в память запись с указанным тегом, если такой записи ещё нет.  
Аргументы  
cwd — Путь к рабочей директории  
tag — Тег записи (например, "TASK", "NOTE")  
content — Содержимое записи  
Возвращает  
True, если запись была добавлена; False, если она уже существует или аргументы пусты

---
def compact_memory_by_priority(content: str, max_bytes: int, priority: List[str]) -> str  
Компактизирует содержимое памяти, оставляя записи в порядке приоритета тегов до достижения лимита по байтам.  
Аргументы  
content — Исходное содержимое памяти  
max_bytes — Максимальный объём в байтах для результата  
priority — Список тегов в порядке убывания приоритета  
Возвращает  
Сжатое содержимое памяти, отсортированное по приоритету и времени
