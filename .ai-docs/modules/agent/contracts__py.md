# agent/contracts

```markdown
Модуль определяет структуры данных и валидационные функции для управления пошаговым выполнением задач в распределённой или параллельной среде. Основные сущности — `PlanStep`, `ExecutorRequest` и `ExecutorResponse` — описывают шаги плана, входные запросы и выходные ответы исполнителя. Валидация входных и выходных данных обеспечивает целостность обмена между оркестратором и исполнителем.

Ключевые структуры данных
PlanStep — Описывает отдельный шаг в плане выполнения задачи, включая зависимости, тип и возможность параллельного выполнения.
ExecutorRequest — Запрос от оркестратора к исполнителю с описанием цели, контекста и ограничений.
ExecutorResponse — Ответ исполнителя с результатами выполнения, статусом и дополнительными данными.

class PlanStep
Описывает шаг в плане выполнения задачи.
Поля
id — Уникальный идентификатор шага.
title — Краткое название шага.
instruction — Подробное описание действий, которые нужно выполнить.
step_type — Тип шага (по умолчанию "task"); может использоваться для маршрутизации или обработки.
parallel_group — Группа для параллельного выполнения; шаги с одинаковым значением могут выполняться параллельно.
depends_on — Список идентификаторов шагов, от которых зависит текущий шаг.
parallelizable — Флаг, указывающий, можно ли безопасно выполнять шаг параллельно.
parallelizable_reason — Обоснование возможности параллельного выполнения (для отладки и аудита).
allowed_tools — Список разрешённых инструментов, которые можно использовать при выполнении шага.
ask_question — Вопрос, который нужно задать пользователю, если шаг требует ввода.
ask_options — Ограниченный набор вариантов ответа на вопрос, если применимо.

---
class ExecutorRequest
Запрос, отправляемый исполнителю для выполнения задачи.
Поля
task_id — Уникальный идентификатор задачи.
goal — Цель выполнения задачи.
context — Контекст, в котором задача должна быть выполнена.
inputs — Дополнительные входные данные в виде словаря.
constraints — Ограничения, которым должно соответствовать выполнение.
allowed_tools — Список инструментов, разрешённых для использования.
expected_outputs — Ожидаемые выходные данные (список описаний).
deadline_ms — Максимальное время выполнения в миллисекундах.
corr_id — Идентификатор корреляции для трассировки запросов.
profile — Имя профиля исполнения (по умолчанию "default").

---
class ExecutorResponse
Ответ, возвращаемый исполнителем после обработки задачи.
Поля
task_id — Идентификатор задачи, для которой возвращается ответ.
status — Статус выполнения: "ok", "needs_input", "error", "timeout", "blocked", "partial".
summary — Краткое резюме выполнения шага.
outputs — Список выходных данных, полученных в результате выполнения.
tool_calls — Список вызовов инструментов, выполненных во время обработки.
next_questions — Список вопросов, требующих ответа от пользователя.

---
def validate_request(req: ExecutorRequest) -> None
Проверяет корректность запроса исполнителя.
Аргументы
req — Объект запроса ExecutorRequest, который необходимо проверить.
Исключения
ValueError — Если task_id или goal пусты, или allowed_tools не является списком или None.

---
def validate_response(resp: ExecutorResponse) -> None
Проверяет корректность ответа исполнителя.
Аргументы
resp — Объект ответа ExecutorResponse, который необходимо проверить.
Исключения
ValueError — Если task_id пуст или статус имеет недопустимое значение.
```
