# agent/contracts

Модуль определяет контракты для планирования, выполнения и управления задачами в рамках автономной системы разработки. Включает структуры для шагов плана, запросов и ответов исполнителя, а также сущности для управления проектами и задачами в режиме менеджера. Предоставляет функции валидации ключевых сообщений между компонентами системы.

Ключевые структуры данных  
PlanStep — Шаг в плане выполнения задачи, может быть частью параллельной группы и иметь зависимости.  
ExecutorRequest — Запрос к исполнителю для выполнения задачи с контекстом и ограничениями.  
ExecutorResponse — Ответ от исполнителя с результатами выполнения, вызовами инструментов и следующими вопросами.  
DevTask — Задача разработки в проекте с критериями принятия, статусом и историей выполнения.  
ProjectPlan — План проекта, состоящий из задач и анализа состояния.  
ReviewResult — Результат проверки выполненной задачи, включая вердикт и комментарии.

class PlanStep  
Описание одного шага в плане выполнения, включая инструкции, тип, зависимости и возможность параллельного выполнения.  
Поля  
id — Уникальный идентификатор шага.  
title — Краткое название шага.  
instruction — Подробная инструкция для выполнения шага.  
step_type — Тип шага (по умолчанию "task").  
parallel_group — Идентификатор группы для параллельного выполнения.  
depends_on — Список идентификаторов шагов, от которых зависит текущий.  
parallelizable — Флаг, указывающий, можно ли выполнять шаг параллельно.  
parallelizable_reason — Обоснование возможности параллельного выполнения.  
allowed_tools — Список разрешённых инструментов для шага.  
ask_question — Вопрос, требующий уточнения от пользователя.  
ask_options — Варианты ответов на вопрос.

---
class ExecutorRequest  
Запрос к исполнителю для выполнения задачи с указанием цели, контекста и ограничений.  
Поля  
task_id — Уникальный идентификатор задачи.  
goal — Цель выполнения задачи.  
context — Контекст, в котором выполняется задача.  
inputs — Входные данные в виде словаря.  
constraints — Ограничения на выполнение.  
allowed_tools — Список разрешённых инструментов.  
expected_outputs — Ожидаемые выходные данные.  
deadline_ms — Максимальное время выполнения в миллисекундах.  
corr_id — Идентификатор корреляции для трассировки.  
profile — Имя профиля исполнения (по умолчанию "default").

---
class ExecutorResponse  
Ответ от исполнителя с результатами выполнения задачи.  
Поля  
task_id — Идентификатор задачи.  
status — Статус выполнения: ok, needs_input, error, timeout, blocked, partial.  
summary — Краткое резюме выполнения.  
outputs — Список выходных данных.  
tool_calls — Вызовы инструментов, выполненные в ходе задачи.  
next_questions — Список вопросов, требующих уточнения от пользователя.

---
validate_request  
Проверяет корректность запроса исполнителя.  
Аргументы  
req — Объект ExecutorRequest для валидации.  
Исключения  
ValueError — Если task_id или goal пусты, или allowed_tools не является списком или None.

---
validate_response  
Проверяет корректность ответа исполнителя.  
Аргументы  
resp — Объект ExecutorResponse для валидации.  
Исключения  
ValueError — Если task_id пуст или status имеет недопустимое значение.

---
class DevTask  
Одна задача разработки в рамках проекта (режим менеджера).  
Поля  
id — Уникальный идентификатор задачи.  
title — Название задачи.  
description — Описание задачи.  
acceptance_criteria — Критерии принятия задачи.  
depends_on — Список идентификаторов зависимых задач.  
status — Текущий статус задачи (по умолчанию "pending").  
attempt — Текущая попытка выполнения.  
max_attempts — Максимальное количество попыток.  
dev_report — Отчёт разработчика по выполнению.  
review_verdict — Вердикт проверки.  
review_comments — Комментарии к проверке.  
rejection_history — История отклонений.  
started_at — Время начала выполнения.  
completed_at — Время завершения.

---
class ProjectAnalysis  
Результат анализа текущего состояния проекта.  
Поля  
current_state — Описание текущего состояния проекта.  
already_done — Список выполненных задач.  
remaining_work — Список оставшейся работы.

---
class ProjectPlan  
План проекта, полученный в результате декомпозиции цели.  
Поля  
project_goal — Цель проекта.  
tasks — Список задач разработки.  
analysis — Анализ текущего состояния проекта (опционально).  
status — Статус плана: active, completed, failed, paused (по умолчанию "active").  
created_at — Время создания плана.  
updated_at — Время последнего обновления.  
current_task_id — Идентификатор текущей выполняемой задачи.  
completion_report — Отчёт о завершении проекта.

---
class ReviewResult  
Результат проверки выполненной задачи.  
Поля  
approved — Признак одобрения задачи.  
summary — Краткое резюме проверки.  
comments — Комментарии к проверке.  
tests_passed — Успешность прохождения тестов (опционально).  
files_reviewed — Список проверенных файлов.
