# agent/session_store

```markdown
Модуль предоставляет потокобезопасные операции чтения и записи JSON-файлов с использованием системных блокировок. Поддерживает чтение с разделяемой блокировкой и запись с эксклюзивной блокировкой, предотвращая гонки при доступе к файлу. Автоматически создаёт родительские директории пути при необходимости. Все операции обрабатывают ошибки и возвращают значения по умолчанию в случае сбоев.

Ключевые структуры данных
Dict[str, Any] — Словарь с произвольными JSON-сериализуемыми данными, используемый как основной тип данных для хранения.

read_json_locked(path: str, default: Optional[Dict[str, Any]] = None) -> Dict[str, Any]
Читает JSON-файл с разделяемой блокировкой, возвращает словарь или значение по умолчанию.
Аргументы
path — Путь к JSON-файлу
default — Значение по умолчанию, возвращаемое при ошибке или пустом файле
Возвращает
Словарь с данными из файла или значение по умолчанию
Исключения
Не выбрасывает исключения, перехватывает все ошибки внутренне

---
write_json_locked(path: str, data: Dict[str, Any]) -> None
Записывает словарь в JSON-файл с эксклюзивной блокировкой и синхронизацией на диск.
Аргументы
path — Путь к JSON-файлу
data — Словарь для записи
Возвращает
Ничего не возвращает
Исключения
Не выбрасывает исключения, все ошибки приводят к остановке с побочными эффектами

---
update_json_locked(path: str, updater: Callable[[Dict[str, Any]], Dict[str, Any]], default: Optional[Dict[str, Any]] = None) -> Dict[str, Any]
Выполняет атомарное чтение, модификацию и запись JSON-файла под эксклюзивной блокировкой.
Аргументы
path — Путь к JSON-файлу
updater — Функция, принимающая текущие данные и возвращающая обновлённый словарь
default — Значение по умолчанию, если файл пуст или повреждён
Возвращает
Обновлённый словарь, записанный в файл
Исключения
Не выбрасывает исключения, все ошибки обрабатываются внутренне
```
