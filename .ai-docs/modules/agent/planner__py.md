# agent/planner

Модуль отвечает за построение плана выполнения задачи пользователя в виде последовательности шагов.  
Использует LLM для генерации структурированного плана в формате JSON, который затем парсится и валидируется.  
При необходимости добавляет шаг уточнения запроса у пользователя.  
Обеспечивает уникальность идентификаторов шагов и корректную типизацию.

Ключевые структуры данных  
PlanStep — Описание одного шага в плане выполнения задачи, включая тип, инструкцию, зависимости и параметры уточнения

---
async def plan_steps(config: AppConfig, user_message: str, context: str) -> List[PlanStep]  
Генерирует список шагов выполнения задачи на основе запроса пользователя и контекста  
Аргументы  
config — Конфигурация приложения, включая параметры LLM  
user_message — Текст запроса пользователя  
context — Дополнительный контекст, доступный планировщику  
Возвращает  
Список объектов PlanStep, представляющих шаги выполнения задачи  
Исключения  
Не выбрасывает исключения явно, обрабатывает ошибки парсинга и возвращает fallback-план

---
def _ensure_unique_step_ids(steps: List[PlanStep]) -> None  
Обеспечивает уникальность идентификаторов всех шагов в списке  
Аргументы  
steps — Список шагов, идентификаторы которых необходимо сделать уникальными  
Возвращает  
None  
Исключения  
Не выбрасывает исключений

---
def _extract_json_object(raw: str) -> str  
Извлекает подстроку с JSON-объектом из сырого текста, удаляя Markdown-разметку при наличии  
Аргументы  
raw — Сырой текст ответа модели, возможно с код-фенами или дополнительным текстом  
Возвращает  
Строка, содержащая валидный JSON-объект, или пустую строку, если объект не найден  
Исключения  
Не выбрасывает исключений
