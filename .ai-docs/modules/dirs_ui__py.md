# dirs_ui

```markdown
Модуль предоставляет функциональность для навигации по каталогам в Telegram-боте с поддержкой постраничного отображения, проверки доступа к директориям и формирования интерактивных клавиатур.  
Он использует состояние пользователя (через `chat_id`) для хранения текущего пути, страницы и списка доступных подкаталогов.  
Реализована защита от выхода за пределы заданного корневого каталога с помощью вспомогательной функции `is_within_root`.

Ключевые структуры данных
dirs_menu — словарь, сопоставляющий chat_id со списком полных путей к подкаталогам.
dirs_base — словарь, хранящий текущий базовый каталог для каждого пользователя.
dirs_page — словарь, отслеживающий номер текущей страницы навигации по каталогам.
dirs_root — словарь, определяющий корневой каталог, из которого нельзя выходить.

prepare_dirs(dirs_menu: Dict[int, list], dirs_base: Dict[int, str], dirs_page: Dict[int, int], dirs_root: Dict[int, str], chat_id: int, base: str, allow_empty: bool = False) -> Optional[str]
Подготавливает список подкаталогов для указанного пути и сохраняет состояние навигации.
Аргументы
dirs_menu — словарь для хранения списка полных путей к подкаталогам по chat_id.
dirs_base — словарь для хранения текущего базового каталога пользователя.
dirs_page — словарь для хранения текущей страницы просмотра каталогов.
dirs_root — словарь с корневыми каталогами пользователей.
chat_id — идентификатор чата, от которого поступил запрос.
base — путь к каталогу, содержимое которого нужно отобразить.
allow_empty — флаг, разрешающий пустые каталоги без подкаталогов.
Возвращает
Сообщение об ошибке, если возникла проблема, иначе None.
Исключения
Любые исключения при чтении каталога логируются и возвращаются как строка ошибки.

---
build_dirs_keyboard(dirs_menu: Dict[int, list], dirs_base: Dict[int, str], dirs_page: Dict[int, int], short_label, chat_id: int, base: str, page: int) -> InlineKeyboardMarkup
Формирует клавиатуру с подкаталогами для Telegram-бота с навигацией и действиями.
Аргументы
dirs_menu — словарь с полными путями к подкаталогам, доступным пользователю.
dirs_base — словарь для обновления текущего каталога пользователя.
dirs_page — словарь для обновления текущей страницы просмотра.
short_label — функция, преобразующая имя каталога в краткую метку для кнопки.
chat_id — идентификатор чата.
base — текущий базовый каталог.
page — номер страницы для постраничного отображения.
Возвращает
Объект InlineKeyboardMarkup, готовый к отправке в Telegram.
```
