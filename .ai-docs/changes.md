# Изменения с последней генерации

## Добавленные файлы

- README.md
- bot.py
- command_registry.py
- config.py
- config_example.yaml
- dirs_ui.py
- git.md
- git_ops.py
- mcp_bridge.py
- metrics.py
- mtproto_ui.py
- requirements.txt
- roadmap.md
- session.py
- session_ui.py
- state.py
- summary.py
- toolhelp.json
- toolhelp.py
- utils.py
## Изменённые файлы

- нет
## Удалённые файлы

- нет
## Перегенерированные разделы

- Тестирование
- Модули
- Конфигурация проекта
- Зависимости
- Запуск и окружение
- Соглашения
- Глоссарий
- Архитектура
- Документация проекта

## Краткое резюме

Внесённые изменения расширяют функциональность Telegram-бота для управления CLI-сессиями, добавляя интерактивный UI, интеграции и механизмы устойчивости. Основные обновления:

- **Управление сессиями через `SessionUI`**: реализовано интерактивное меню с поддержкой просмотра статуса, переименования, обновления resume-токена и управления очередью. Обработка колбэков и текстовых сообщений обеспечивает плавное взаимодействие.
- **Git-операции в Telegram**: добавлен `GitOps` с поддержкой `pull`, `push`, `commit`, `merge`, `rebase`, `stash`. Все операции безопасны, требуют подтверждения, отображают diff и управляются через inline-кнопки.
- **MTProto-интеграция**: реализована отправка сообщений и файлов в Telegram-чаты через Telethon. Требует `api_id`, `api_hash`, `session_string` и настраивается через `mtproto.targets`.
- **MCP-совместимость**: добавлен TCP-сервер (`MCPBridge`) для внешних JSON-запросов с авторизацией по токену. Поддерживает сессии и прямую передачу промптов.
- **Конфигурация и безопасность**: полная поддержка `config.yaml` с переменными окружения, whitelist чатов, защита от выхода за пределы `workdir`, проверка типов вложений.
- **Работа с файлами и изображениями**: просмотр директорий, загрузка, удаление, вставка текста в промпт (до 300 КБ), обработка изображений при наличии `image_cmd`.
- **Рендеринг вывода**: преобразование ANSI → HTML, поддержка Markdown, задач, таблиц и Mermaid-диаграмм (рендер в SVG).
- **Состояние и восстановление**: сессии сохраняются в `state.json`, включая активную сессию, токены, очередь. Автоматическое восстановление при перезапуске.
- **Дополнительные функции**: кэширование справки по инструментам (`toolhelp.json`), шаблоны команд (`presets`), генерация сообщений коммитов через OpenAI, буферизация и отложенная отправка сообщений.
- **Метрики и мониторинг**: сбор статистики по командам, ошибкам, объёму вывода, формирование отчётов через `Metrics`.

Система теперь поддерживает автономную работу с глубокой интеграцией в локальное окружение (сессии, Git, файлы), сохраняя гибкость и безопасность.
